 {% extends 'base.html' %}
{% load static %}

{% block title %} <title>Society Management | Member-Master-Creation</title> {% endblock title %}

{% block body %}

<div class="container">

    <ul class="nav nav-tabs" id="myTab" role="tablist" style="display: flex; justify-content: center;">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" style="font-family: 'Calibri', sans-serif;" id="purchase-tab"
                data-bs-toggle="tab" data-bs-target="#purchase-tab-pane" type="button" role="tab"
                aria-controls="purchase-tab-pane" aria-selected="true">Purchase Voucher</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" style="font-family: 'Calibri', sans-serif;" id="sale-tab" data-bs-toggle="tab"
                data-bs-target="#sale-tab-pane" type="button" role="tab" aria-controls="sale-tab-pane"
                aria-selected="false">Sale Voucher</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" style="font-family: 'Calibri', sans-serif;" id="journal-tab" data-bs-toggle="tab"
                data-bs-target="#journal-tab-pane" type="button" role="tab" aria-controls="journal-tab-pane"
                aria-selected="false">Journal Voucher</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" style="font-family: 'Calibri', sans-serif;" id="expense-tab" data-bs-toggle="tab"
                data-bs-target="#expense-tab-pane" type="button" role="tab" aria-controls="expense-tab-pane"
                aria-selected="false">Expense Voucher</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" style="font-family: 'Calibri', sans-serif;" id="income-tab" data-bs-toggle="tab"
                data-bs-target="#income-tab-pane" type="button" role="tab" aria-controls="income-tab-pane"
                aria-selected="false">Income Voucher</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" style="font-family: 'Calibri', sans-serif;" id="payment-tab" data-bs-toggle="tab"
                data-bs-target="#payment-tab-pane" type="button" role="tab" aria-controls="payment-tab-pane"
                aria-selected="false">Payment Voucher</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" style="font-family: 'Calibri', sans-serif;" id="receipt-tab" data-bs-toggle="tab"
                data-bs-target="#receipt-tab-pane" type="button" role="tab" aria-controls="receipt-tab-pane"
                aria-selected="false">Receipt Voucher</button>
        </li>
    </ul>
    <div class="tab-content" id="costCenterEntirePage">

        <!-- AGAINST REFRENCE MODAL (ARM) -->
        <div class="modal fade" id="addRefrenceModal" tabindex="-1" aria-labelledby="addRefrenceModalLabel" aria-hidden="true" data-bs-backdrop="static">
            <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="addRefrenceModalLabel">Add Against Refrence </h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" @click="closeRefrenceModal"></button>
                    </div>
                    <div class="modal-body">
                        <h3>Total Amount To Be Allocated</h3>
                        <table class="table table-sm table-bordered">
                            <thead class="table-dark">
                                <th style="text-align:center;">Id</th>
                                <th style="text-align:center;">Voucher No.</th>
                                <th style="text-align:center;">Date</th>
                                <th style="text-align:center;">Pending Amt.</th>
                                <th style="text-align:center;">Final Amt.</th>
                                <th style="text-align:center;">Allocate Amt.</th>
                            </thead>
                            <tbody>
                                {% verbatim %}
                                <tr v-for="(item, index) in againstRefrences" :key="index">
                                    <td>{{ index }}</td>
                                    <td>{{ item.voucher_number }}</td>
                                    <td>{{ item.voucher_date }}</td>
                                    <td>{{ item.pending_amt }}</td>
                                    <td>{{ item.final_amt }}</td>
                                    <!-- <td v-if="item.credit">{{ item.credit }}</td>
                                    <td v-else>{{ item.debit }}</td>
                                    <td v-if="item.credit">{{ item.credit }}</td>
                                    <td v-else>{{ item.debit }}</td> -->
                                    <td class="text-center">
                                        <input class="mt-1" v-model="item.allocated_amt" type="number" style="width: 75%; border: none; border-color: transparent; text-align:center;" placeholder="Enter Allocate Amt">
                                    </td>
                                </tr>
                                {% endverbatim %}
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" @click="closeRefrenceModal">Close</button>
                        <button type="button" class="btn btn-primary" @click="openCostCenter">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW VOUCHER DATA(VVDPS) -->
        <div class="modal fade" id="viewVoucherDataModalPS" tabindex="-1" aria-labelledby="viewVoucherDataModalPSLabel" aria-hidden="true" data-bs-backdrop="static">
            <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="viewVoucherDataModalPSLabel">Voucher Details</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    {% verbatim %}
                    <div class="modal-body">
                        <div class="text-center">
                            <div class="row">
                                <h3><u>Voucher Details</u></h3>
                                <div class="col-lg-4">
                                    <span><b>Vendor Name: </b></span><span>{{ showVoucherDetails.vendor_name }}</span>
                                </div>
                                <div class="col-lg-4">
                                    <span><b>Vendor Invoice Number: </b></span><span>{{ showVoucherDetails.vendor_invoice_number }}</span>
                                </div>
                                <div class="col-lg-4">
                                    <span><b>Voucher Type: </b></span><span>{{ showVoucherDetails.voucher_name }}</span>
                                </div>
                                <div class="col-lg-4">
                                    <span><b>Voucher Number: </b>{{ showVoucherDetails.voucher_number }}</span>
                                </div>
                                <div class="col-lg-4">
                                    <span><b>Booking Date: </b>{{ showVoucherDetails.booking_date }}</span>
                                </div>
                                <div class="col-lg-4">
                                    <span><b>Narration: </b>{{ showVoucherDetails.narration }}</span>
                                </div>
                                <div class="col-lg-4">
                                    <span><b>Cheque No: </b>{{ showVoucherDetails.cheque_number }}</span>
                                </div>
                            </div>

                            <hr>

                            <!-- Required for stock -->
                            <div class="row text-center mx-5">
                                <h3 class="mt-2"><u>Stock Details</u></h3>
                                <table class="table table-sm table-bordered">
                                    <thead class="table-dark">
                                        <th style="text-align:center;">Stock</th>
                                        <th style="text-align:center;">Quantity</th>
                                        <th style="text-align:center;">Rate</th>
                                        <th style="text-align:center;">Amount</th>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(item, index) in showStocks" :key="index">
                                            <td class="text-center">
                                                {{ item.stock_name }}
                                            </td>
                                            <td class="text-center">
                                                {{ item.quantity }}
                                            </td>
                                            <td class="text-center">
                                                {{ item.rate }}
                                            </td>
                                            <td class="text-center">
                                                {{ item.amount }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <th id="total" colspan="2" class="text-center">Total :</th>
                                            <td style="text-align: center">Total Amount: <span class="ms-3">{{ showVoucherDetails.total_purchases }}</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    {% endverbatim %}
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- VIEW VOUCHER DATA(VVD) -->
        <div class="modal fade" id="viewVoucherDataModal" tabindex="-1" aria-labelledby="viewVoucherDataModalLabel" aria-hidden="true" data-bs-backdrop="static">
            <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="viewVoucherDataModalLabel">Voucher Details</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    {% verbatim %}
                    <div class="modal-body">
                        <div class="text-center">
                            <div class="row">
                                <h3><u>Voucher Details</u></h3>
                                <div class="col-lg-4">
                                    <span><b>Voucher Type: </b></span><span>{{ showVoucherDetails.voucher_name }}</span>
                                </div>
                                <div class="col-lg-4">
                                    <span><b>Voucher Number: </b>{{ showVoucherDetails.voucher_number }}</span>
                                </div>
                                <div class="col-lg-4">
                                    <span><b>Booking Date: </b>{{ showVoucherDetails.booking_date }}</span>
                                </div>
                                <div class="col-lg-4">
                                    <span><b>Narration: </b>{{ showVoucherDetails.narration }}</span>
                                </div>
                                <div class="col-lg-4">
                                    <span><b>Cheque No: </b>{{ showVoucherDetails.cheque_number }}</span>
                                </div>
                                <div class="col-lg-4">
                                    <span><b>Bank Name: </b>{{ showVoucherDetails.bank_name }}</span>
                                </div>
                            </div>

                            <hr>
                            <div class="row text-center mx-5">
                                <h3 class="mt-2"><u>Entry Details</u></h3>
                                <table class="table table-sm table-bordered">
                                    <thead class="table-dark">
                                        <th style="text-align:center;">Type</th>
                                        <th style="text-align:center;">Ledger Name</th>
                                        <th style="text-align:center;">Debit Amount</th>
                                        <th style="text-align:center;">Credit Amount</th>
                                        <th style="text-align:center;">Against Refrence</th>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(item, index) in showRelatedLedgers" :key="index">
                                            <td style="text-align:center;">
                                                <span v-if="item.debit_amt">DR</span>
                                                <span v-else>CR</span>
                                            </td>
                                            <td class="text-center">
                                                {{ item.ledger_name }}
                                            </td>
                                            <td class="text-center">
                                                {{ item.debit_amt }}
                                            </td>
                                            <td class="text-center">
                                                {{ item.credit_amt }}
                                            </td>
                                            <td v-if="Array.isArray(item.show_against_refrence) && item.show_against_refrence.length !== 0">
                                                <table class="table table-sm table-bordered">
                                                    <thead class="table-dark">
                                                        <th style="text-align:center;">Voucher Number</th>
                                                        <th style="text-align:center;">Pending Amount</th>
                                                        <th style="text-align:center;">Final Amount</th>
                                                        <th style="text-align:center;">Allocated Amount</th>
                                                    </thead>
                                                    <tbody>
                                                        <tr v-for="(ref, index) in item.show_against_refrence" :key="index">
                                                            <td>{{ ref.voucher_number }}</td>
                                                            <td>{{ ref.pending_amt }}</td>
                                                            <td>{{ ref.final_amt }}</td>
                                                            <td>{{ ref.allocated_amt }}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th id="total" colspan="2" class="text-center">Total :</th>
                                            <td style="text-align: center">Debit Total: <span class="ms-3">{{ showVoucherDetails.debit_total }}</span></td>
                                            <td style="text-align: center">Credit Total: <span class="ms-3">{{ showVoucherDetails.credit_total }}</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- <div class="row text-center mt-3 mx-3">
                                <h3><u>Against Refrence Details</u></h3>
                                <table class="table table-sm table-bordered">
                                    <thead class="table-dark">
                                        <th style="text-align:center;">Voucher No.</th>
                                        <th style="text-align:center;">Voucher Date</th>
                                        <th style="text-align:center;">Pending Amt.</th>
                                        <th style="text-align:center;">Final Amt.</th>
                                        <th style="text-align:center;">Allocated Amt.</th>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(item, index) in purchases" :key="index">
                                            <td style="text-align:center;">
                                                VOUCHER-456-2024
                                            </td>
                                            <td class="text-center">
                                                2000-09-09
                                            </td>
                                            <td class="text-center">
                                                5000
                                            </td>
                                            <td class="text-center">
                                                10000
                                            </td>
                                            <td class="text-center">
                                                5000
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="row text-center mt-3 mx-3">
                                <h3><u>Cost Center Details</u></h3>
                                <table class="table table-sm table-bordered">
                                    <thead class="table-dark">
                                        <th style="text-align:center;">Cost Center Name</th>
                                        <th style="text-align:center;">Cost Center Amt.</th>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(item, index) in purchases" :key="index">
                                            <td style="text-align:center;">
                                                Machines
                                            </td>
                                            <td class="text-center">
                                                3000
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div> -->
                        </div>
                    </div>
                    {% endverbatim %}
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create New Ledger Modal -->
        <div class="modal fade" id="createNewLedger" tabindex="-1" aria-labelledby="createNewLedgerLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="createNewLedgerLabel">Ledger Creation Form</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" @click="createNewLedgerBtn"></button>
                </div>
                <div class="modal-body">
                    {% verbatim %}
                    <form @submit.prevent="submitLedger(formData.id)" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-lg-4 pe-3 mb-3" style="border-right: 1px solid grey;">
                                <div class="sty-input-wrapper w-100 mb-2">
                                    <input type="text" class="sty-inp form-control w-100"
                                        v-model="formData.ledger_name"
                                        :class="{ 'error-message': errors.ledger_name }">
                                    <label class="sty-label">Ledger Name</label>
                                    <span v-if="errors.ledger_name" class="error">{{ errors.ledger_name[0]
                                        }}</span>
                                    <span v-else></span>
                                </div>

                                <div class="sty-input-wrapper w-100 mb-2">
                                    <input type="text" class="sty-inp form-control w-100"
                                        v-model="formData.alis" :class="{ 'error-message': errors.alis }">
                                    <label class="sty-label">Alias</label>
                                    <span v-if="errors.alis" class="error">{{ errors.alis[0] }}</span>
                                    <span v-else></span>
                                </div>

                                <div class="sty-input-wrapper w-100 mb-2">
                                    <select class="w-100 sty-inp" style="background-color: white;"
                                        id="ledgerSelection">
                                        <option value="">Select Sub Group</option>
                                        <option v-for="item in subGroups" :value="item">{{ item }}</option>
                                    </select>
                                    <label class="sty-label">Group Name</label>
                                    <span v-if="groupError && Object.keys(groupError).length > 0" class="error">{{ groupError }}</span>
                                    <span v-else></span>
                                </div>

                                <div class="sty-input-wrapper w-100 mb-2">
                                    <input type="text" class="sty-inp form-control w-100"
                                        v-model="formData.pan_number"
                                        :class="{ 'error-message': errors.pan_number }">
                                    <label class="sty-label">PAN Number</label>
                                    <span v-if="errors.pan_number" class="error">{{ errors.pan_number[0]
                                        }}</span>
                                    <span v-else></span>
                                </div>
                            </div>

                            <div class="col-lg-4 mb-3 pe-3" style="border-right: 1px solid grey;">
                                <div class="sty-input-wrapper w-100 mb-2">
                                    <select class="form-control sty-inp w-100" v-model="formData.nature"
                                        :class="{ 'error-message': errors.nature }">
                                        <option value="" selected>Select Nature</option>
                                        <option value="fixed_nature">Fixed</option>
                                        <option value="variable_nature">Variable</option>
                                    </select>
                                    <label class="sty-label">Nature Type</label>
                                    <span v-if="errors.nature" class="error">{{ errors.nature[0] }}</span>
                                    <span v-else></span>
                                </div>

                                <div class="sty-input-wrapper w-100 mb-2"
                                    v-show="formData.nature === 'variable_nature'">
                                    <select class="form-control sty-inp w-100" v-model="formData.based_on"
                                        :class="{ 'error-message': errors.based_on }">
                                        <option value="" selected>Select Type</option>
                                        <option value="area">Area</option>
                                        <option value="fixed">Fixed</option>
                                    </select>
                                    <label class="sty-label">Based On</label>
                                    <span v-if="errors.based_on" class="error">{{ errors.based_on[0] }}</span>
                                    <span v-else></span>
                                </div>

                                <div v-show="formData.nature === 'variable_nature' && formData.based_on === 'area'"
                                    class="sty-input-wrapper w-100" :class="{ 'error-message': errors.area }">
                                    <input type="number" class="form-control sty-inp w-100"
                                        v-model="formData.area">
                                    <label class="sty-label">Area</label>
                                    <span v-if="errors.area" class="error">{{ errors.area[0] }}</span>
                                    <span v-else></span>
                                </div>

                                <div v-show="formData.nature === 'variable_nature' && formData.based_on === 'fixed'"
                                    class="sty-input-wrapper w-100" :class="{ 'error-message': errors.fixed }">
                                    <input type="number" class="form-control sty-inp w-100"
                                        v-model="formData.fixed">
                                    <label class="sty-label">Fixed</label>
                                    <span v-if="errors.fixed" class="error">{{ errors.fixed[0] }}</span>
                                    <span v-else></span>
                                </div>
                            </div>

                            <div class="col-lg-4 mb-3">
                                <div class="sty-input-wrapper w-100 mb-2">
                                    <input type="text" class="sty-inp form-control w-100"
                                        v-model="formData.gst_number"
                                        :class="{ 'error-message': errors.gst_number }">
                                    <label class="sty-label">GST Number</label>
                                    <span v-if="errors.gst_number" class="error">{{ errors.gst_number[0]
                                        }}</span>
                                    <span v-else></span>
                                </div>

                                <div class="sty-input-wrapper w-100 mb-2">
                                    <input type="text" class="sty-inp form-control w-100"
                                        v-model="formData.contact_person_name"
                                        :class="{ 'error-message': errors.contact_person_name }">
                                    <label class="sty-label">Contact Person Name</label>
                                    <span v-if="errors.contact_person_name" class="error">{{
                                        errors.contact_person_name[0] }}</span>
                                    <span v-else></span>
                                </div>

                                <div class="sty-input-wrapper w-100">
                                    <input type="text" class="sty-inp form-control w-100"
                                        v-model="formData.contact_person_number"
                                        :class="{ 'error-message': errors.contact_person_number }">
                                    <label class="sty-label">Contact Person Number</label>
                                    <span v-if="errors.contact_person_number" class="error">{{
                                        errors.contact_person_number[0] }}</span>
                                    <span v-else></span>
                                </div>

                                <div class="sty-input-wrapper w-100">
                                    <input type="email" class="sty-inp form-control w-100"
                                        v-model="formData.contact_person_email"
                                        :class="{ 'error-message': errors.contact_person_email }">
                                    <label class="sty-label">Contact Person Email ID</label>
                                    <span v-if="errors.contact_person_email" class="error">{{
                                        errors.contact_person_email[0] }}</span>
                                    <span v-else></span>
                                </div>
                            </div>

                            <hr>

                            <div class="col-lg-12">
                                <div class="sty-input-wrapper mb-3 w-100">
                                    <textarea class="sty-inp form-control w-100" cols="30" rows="1"
                                        v-model="formData.address"
                                        :class="{ 'error-message': errors.address }"></textarea>
                                    <label class="sty-label">Address</label>
                                    <span v-if="errors.address" class="error">{{ errors.address[0] }}</span>
                                    <span v-else></span>
                                </div>

                                <div class="row mb-3">

                                    <div class="col-lg-3 sty-input-wrapper">
                                        <select id="country" @change="getStates"
                                            class="sty-inp form-control w-100" v-model="formData.country"
                                            :class="{ 'error-message': errors.country }">
                                            <option value="">Select Country</option>
                                            <option v-for="country in countries" :value="country.iso2">{{
                                                country.name }}</option>
                                        </select>
                                        <label class="sty-label">Country</label>
                                        <span v-if="errors.country" class="error">{{ errors.country[0] }}</span>
                                        <span v-else></span>
                                    </div>

                                    <div class="col-lg-3 sty-input-wrapper">
                                        <select class="sty-inp form-control w-100" id="state"
                                            @change="getCities" :disabled="!formData.country"
                                            v-model="formData.state" :class="{ 'error-message': errors.state }">
                                            <option value="">Select State</option>
                                            <option v-for="state in states" :value="state.iso2">{{ state.name }}
                                            </option>
                                        </select>
                                        <label for="" class="sty-label">State</label>
                                        <span v-if="errors.state" class="error">{{ errors.state[0] }}</span>
                                        <span v-else></span>
                                    </div>

                                    <div class="col-lg-3 sty-input-wrapper">
                                        <select id="city" class="sty-inp form-control w-100"
                                            :disabled="!formData.state" v-model="formData.city"
                                            :class="{ 'error-message': errors.city }">
                                            <option value="">Select City</option>
                                            <option v-for="city in cities" :value="city.name">{{ city.name }}
                                            </option>
                                        </select>
                                        <label for="" class="sty-label">City</label>
                                        <span v-if="errors.city" class="error">{{ errors.city[0] }}</span>
                                        <span v-else></span>
                                    </div>

                                    <div class="col-lg-3 sty-input-wrapper">
                                        <input type="text" class="sty-inp form-control w-100"
                                            v-model="formData.pin_code"
                                            :class="{ 'error-message': errors.pin_code }">
                                        <label class="sty-label">Pincode</label>
                                        <span v-if="errors.pin_code" class="error">{{ errors.pin_code[0]
                                            }}</span>
                                        <span v-else></span>
                                    </div>
                                </div>
                            </div>

                            <hr>

                            <div class="col-lg-4 mb-3">
                                <div class="sty-input-wrapper w-100">
                                    <input type="text" class="sty-inp form-control w-100"
                                        v-model="formData.beneficiary_name"
                                        :class="{ 'error-message': errors.beneficiary_name }">
                                    <label class="sty-label">Beneficiary Name</label>
                                    <span v-if="errors.beneficiary_name" class="error">{{
                                        errors.beneficiary_name[0] }}</span>
                                    <span v-else></span>
                                </div>
                            </div>

                            <div class="col-lg-4 mb-3">
                                <div class="sty-input-wrapper w-100">
                                    <input type="number" class="sty-inp form-control w-100"
                                        v-model="formData.account_no"
                                        :class="{ 'error-message': errors.account_no }">
                                    <label class="sty-label">Account Number</label>
                                    <span v-if="errors.account_no" class="error">{{ errors.account_no[0]
                                        }}</span>
                                    <span v-else></span>
                                </div>
                            </div>

                            <div class="col-lg-4 mb-3">
                                <div class="sty-input-wrapper w-100">
                                    <input type="text" v-model="formData.ifsc_code" id="ifsc" name="ifsc"
                                        @input="getBranchName" class="sty-inp form-control w-100"
                                        :class="{ 'error-message': errors.ifsc_code }">
                                    <label class="sty-label">IFSC Code</label>
                                    <span v-if="errors.ifsc_code" class="error">{{ errors.ifsc_code[0] }}</span>
                                    <span v-else></span>
                                </div>
                            </div>

                            <div class="col-lg-4 mb-3">
                                <div class="sty-input-wrapper w-100">
                                    <input type="text" class="sty-inp form-control w-100"
                                        v-model="formData.bank_name" id="bank" name="bank"
                                        :class="{ 'error-message': errors.bank_name }">
                                    <label class="sty-label">Bank Name</label>
                                    <span v-if="errors.bank_name" class="error">{{ errors.bank_name[0] }}</span>
                                    <span v-else></span>
                                </div>
                            </div>

                            <div class="col-lg-4 mb-3">
                                <div class="sty-input-wrapper w-100">
                                    <input type="text" class="sty-inp form-control w-100"
                                        v-model="formData.branch_name" id="branch" name="branch">
                                    <label class="sty-label">Branch Name</label>
                                    <span v-if="errors.branch_name" class="error">{{ errors.branch_name[0]
                                        }}</span>
                                    <span v-else></span>
                                </div>
                            </div>

                            <div class="col-lg-4 mb-3 ">
                                <div class="sty-input-wrapper d-flex w-100">
                                    <input type="number" class="sty-inp form-control w-100"
                                        v-model="formData.opening_balance"
                                        :class="{ 'error-message': errors.opening_balance }">
                                    <label class="sty-label">Opening Balance</label>
                                    <span v-if="errors.opening_balance" class="error">{{
                                        errors.opening_balance[0] }}</span>
                                    <span v-else></span>

                                    <select class="sty-inp form-control w-25" v-model="formData.dr_cr"
                                        :class="{ 'error-message': errors.dr_cr }">
                                        <option value="">Dr/Cr</option>
                                        <option value="dr">Dr</option>
                                        <option value="cr">Cr</option>
                                    </select>
                                    <span v-if="errors.dr_cr" class="error">{{ errors.dr_cr[0] }}</span>
                                    <span v-else></span>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                                @click="createNewLedgerBtn">Close</button>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                    </form>
                    {% endverbatim %}
                </div>
            </div>
        </div>
        </div>

        <!-- GROUP CREATE MODAL -->
        <div class="modal fade" id="groupCreationModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered">
                <div class="modal-content">
                    {% verbatim %}
                    <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Group Creation</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" @click="groupCreationModalClose"></button>
                    </div>
                    <div class="modal-body">

                        <div class="row">
                            <div class="sty-input-wrapper w-100 mb-3">
                                <input type="text" class="sty-inp form-control" v-model="name" :style="{ borderColor: errors.group_name || errors.already_exist ? 'red' : '' || errors.same_child_parent ? 'red' : '' }" style="text-transform: capitalize;">
                                <label class="sty-label">Group Name</label>
                                <span v-if="errors.group_name || errors.already_exist || errors.same_child_parent" class="error">{{ errors.group_name || errors.already_exist || errors.same_child_parent }}</span>
                                <span v-else></span>
                            </div>

                            <div class="sty-input-wrapper w-100 mb-3">
                                <div class="w-100 sty-input-wrapper">
                                    <select class="w-100 sty-inp" style="background-color: white;" @change="updateSubGroups($event)" v-model="superParent">
                                        <option value="">Select Under Group</option>
                                        <option value="Assets">Assets</option>
                                        <option value="Liabilities">Liabilities</option>
                                        <option value="Income">Income</option>
                                        <option value="Expenses">Expenses</option>
                                        <option value="Bank">Bank</option>
                                    </select>
                                    <label class="sty-label">Under Group</label>
                                    <span v-if="errors.parent_name" class="error">{{ errors.parent_name }}</span>
                                    <span v-else></span>
                                </div>
                            </div>

                            <div class="sty-input-wrapper w-100 mb-3">
                                <select class="w-100 sty-inp" id="groupSelection" style="background-color: white;" :style="{ borderColor: errors.under_group ? 'red' : '' }">
                                    <option value="">Select Sub Group</option>
                                    <option v-for="item in subGroupsOnGroupModal" :value="item">{{ item }}</option>
                                </select>
                                <label class="sty-label">Sub Group</label>
                                <span v-if="errors.under_group" class="error">{{ errors.under_group }}</span>
                                <span v-else></span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" @click="groupCreationModalClose">Close</button>
                        <button type="button" class="btn btn-primary" @click="submitGroup(0)">Add Group</button>
                    </div>
                    {% endverbatim %}
                </div>
            </div>
        </div>

        <!-- ADD SHARES(CSM) -->
        <div class="modal fade" id="createShareModal" tabindex="-1" aria-labelledby="createShareModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered">
            {% verbatim %}
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="createShareModalLabel">Add Stock Detail</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-6">
                            <div class="sty-input-wrapper w-100 mb-3">
                                <input type="text" class="sty-inp form-control" v-model="sharesData.stock_name" :class="{ 'error-message': errors.stock_name }">
                                <label class="sty-label">Stock Name</label>
                                <span v-if="errors.stock_name" class="error">{{ errors.stock_name[0] }}</span>
                                <span v-else></span>
                            </div>
                        </div>

                        <div class="col-6">
                            <div class="sty-input-wrapper w-100 mb-3">
                                <select class="w-100 sty-inp" style="background-color: white;" v-model="sharesData.stock_type" :class="{ 'error-message': errors.stock_type }">
                                    <option value="Select Stock Type">Select Stock Type</option>
                                    <option value="unit">Unit</option>
                                    <option value="pieces">Pieces</option>
                                </select>
                                <label class="sty-label">Stock Type</label>
                                <span v-if="errors.stock_type" class="error">{{ errors.stock_type[0] }}</span>
                                <span v-else></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" @click="submitShares">Add</button>
                </div>
            </div>
            {% endverbatim %}
            </div>
        </div>


        <div class="tab-pane fade show active" id="purchase-tab-pane" role="tabpanel" aria-labelledby="purchase-tab" tabindex="0">
            <div class="d-flex mt-3 mb-2">
                <h3 class="">Purchase Voucher</h3>
                <button type="button" class="ms-auto add-mem-btn" @click="openVoucherModal('purchase_voucher')">Create Voucher</button>
                <button type="button" class="add-mem-btn">Settings</button>
            </div>
            {% verbatim %}
            <div>
                <table id="purchaseVoucherDatatable" class="display dt-table order-column" style="width:100%">
                    <!-- <table id="houseHelpDataTable"> -->
                    <thead>
                        <tr>
                            <th>Actions</th>
                            <th>Id</th>
                            <th>Voucher Type</th>
                            <th>Voucher Name</th>
                            <th>Voucher Number</th>
                            <th>Booking Date</th>
                            <th>Vendor Name</th>
                            <th>Vendor Invoice No.</th>
                            <th>Amount In Words</th>
                            <th>Narration</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, index) in purchaseVoucherDatatable" :key="index">
                            <td>
                                <span @click="viewRequestedData(item.id, 'true')" class="me-3"><i class="fa-solid fa-eye"></i></span>
                                <span @click="editRequestedData(item.id)"><i class="fa-solid fa-pen-to-square"></i></span>
                            </td>
                            <td v-for="(value, key) in item" :key="key">{{ value }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            {% endverbatim %}

            <!-- CREATE MODAL FOR PURCHASE VOUCHER(PUVM) -->
            <div class="modal fade" id="purchaseVoucherCreate" tabindex="-1" data-bs-backdrop="static" aria-labelledby="purchaseVoucherCreateLabel" aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="purchaseVoucherCreateLabel">Add Purchase Voucher</h5>
                            <button type="button" class="btn-close" @click="destroySelect2"></button>
                        </div>
                        {% verbatim %}
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <select class="w-100 sty-inp form-control" v-model="formData2.voucher_type" @change="fetchVoucherNumber2($event)">
                                            <option value="">Select Voucher Type</option>
                                            <option v-for="voucher in vouchersList" :value="voucher.id">{{ voucher.voucher_name }}</option>
                                        </select>
                                        <label class="sty-label" for="">Voucher Type</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="text" v-model="formData2.voucher_number">
                                        <label class="sty-label" for="">Voucher Number</label>
                                    </div>
                                </div>

                                <input class="sty-inp form-control" type="text" v-model="formData2.suffix" hidden>
                                <input class="sty-inp form-control" type="text" v-model="formData2.prefix" hidden>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="date" v-model="formData2.booking_date">
                                        <label class="sty-label" for="">Booking Date</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <select class="w-100 sty-inp form-control selectLedger">
                                            <option value="">Select Ledger</option>
                                            <option v-for="ledger in ledgerList" :value="ledger.id">{{ ledger.ledger_name }}</option>
                                        </select>
                                        <label class="sty-label">Vendor Name</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control w-100" type="date"
                                            v-model="formData2.invoice_date">
                                        <label class="sty-label">Invoice Date</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control w-100" type="text"
                                            v-model="formData2.invoice_number">
                                        <label class="sty-label" for="">Vendor Invoice Number</label>
                                    </div>
                                </div>

                            </div>
                            <hr class="mt-1 mb-3">
                            <div>
                                <table class="table table-sm table-bordered">
                                    <thead class="table-dark">
                                        <tr>
                                            <th style="text-align:center;" width="5%">Stock</th>
                                            <th style="text-align:center;">Quantity</th>
                                            <th style="text-align:center;" width="5%">Rate</th>
                                            <th style="text-align:center;" width="5%">Amount</th>
                                            <th style="text-align:center;" width="5%">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(item, index) in purchases" :key="index">
                                            <td style="text-align:center;" width="5%">
                                                <select class="selectLedger" style="width: 50%; border: none; border-color: transparent;">
                                                    <option value="">Select Stock</option>
                                                    <option v-for="shares in sharesList" :value="shares.id">{{ shares.stock_name }}</option>
                                                </select>
                                                <p class="mt-1 text-danger" v-if="errors[index] && errors[index].stock_name">{{  errors[index].ledger_name[0] }}</p>
                                                <span v-else></span>
                                            </td>

                                            <td style="text-align:center;" width="5%">
                                                <input type="text" style="width: 60%; border: none; border-color: transparent;" placeholder="Enter Quantity" v-model="item.quantity" @input="calculateAmount(item)">
                                                <p class="mt-1 text-danger" v-if="errors[index] && errors[index].quantity">{{ errors[index].quantity[0] }}</p>
                                                <span v-else></span>
                                            </td>

                                            <td style="text-align:center;" width="5%">
                                                <input type="text" style="width: 60%; border: none; border-color: transparent;" placeholder="Enter Rate" v-model="item.rate" @input="calculateAmount(item)" @keyup.enter="openCostCenter2(index)" >
                                                <p class="mt-1 text-danger" v-if="errors[index] && errors[index].rate">{{ errors[index].rate[0] }}</p>
                                                <span v-else></span>
                                            </td>

                                            <td style="text-align:center;" width="5%">
                                                <input type="text" style="width: 60%; border: none; border-color: transparent; outline: none;" placeholder="Amount" v-model="item.amount" @keyup.tab.prevent="openCostCenter2(index)" readonly>
                                            </td>

                                            <td style="text-align:center;" width="5%">
                                                <span style="width: 60%; border: none; border-color: transparent;" @click="removeCostCenter(index)" v-if="index !== 0" >
                                                    <i class="fa-solid fa-trash-can text-danger"></i>
                                                </span>
                                                <!-- <span style="width: 60%; border: none; border-color: transparent;" @click="openCostCenterModal(index + 1, item.id)">
                                                    <i class="fa-solid fa-pen"></i>
                                                </span> -->
                                                <span v-if="errors.wing_flat" class="error">{{ errors.wing_flat[0] }}</span>
                                                <span v-else></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th style="text-align:center;" colspan="3">Total</th>
                                            <td style="text-align: center;">
                                                <input type="text" style="width: 50%; border: none; border-color: transparent; outline: none;" placeholder="Total Amount" v-model="formData2.total_purchases" readonly>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>

                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input type="text" class="sty-inp form-control" style="text-transform: capitalize;" v-model="formData2.amount_in_words">
                                            <label class="sty-label" for="">Amount in Words</label>
                                        </div>
                                    </div>

                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <textarea class="sty-inp form-control" cols="30" rows="1" v-model="formData2.narration"></textarea>
                                            <label class="sty-label" for="">Narration</label>
                                        </div>
                                    </div>

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" @click="saveVoucherDetailsHavingFormData2">Save</button>
                                </div>
                            </div>
                        </div>
                        {% endverbatim %}
                    </div>
                </div>
            </div>
        </div>

        <!-- CREATE MODAL FOR ADD COST CENTER (CCM) -->
        <div class="modal fade" id="CostCenterModal" tabindex="-1" data-bs-backdrop="static" aria-labelledby="CostCenterModalLabel" aria-hidden="true">
         {% verbatim %}
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <span class="modal-title" style="font-size: 21px;" id="CostCenterModalLabel">Add Cost Center</span>
                        <span class="text-right"><input style="border: none; border-color: transparent; outline: none; font-size: 21px;" type="number" v-model="displayAmount" readonly></span>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <span v-if="amountMatchedError" class="text-center">{{ amountMatchedError }}</span>
                            <span style="font-size: 21px;" id="CostCenterModalLabel">Total Amount:</span><span style="font-size: 21px;" class="ms-5">0</span>
                            <span class="text-right"><input style="border: none; border-color: transparent; outline: none; font-size: 21px;" type="number" v-model="displayAmount" readonly></span>

                            <div class="row mb-3" v-for="(item, index) in items" :key="item.id">
                                <div class="col-5">
                                    <div class="sty-input-wrapper w-100">
                                        <!-- <select class="costCenterSelect2" v-model="items[index].id"> -->
                                        <select class="w-100 sty-inp form-control" v-model="item.cost_center_name">
                                            <option value="">Select Cost Center</option>
                                            <option v-for="costCenter in costCenterData" :value="costCenter.id">{{ costCenter.name }}</option>
                                        </select>
                                    </div>
                                    <span v-if="costCenterError && costCenterError.cost_center_name || costCenterNotProvided" class="error">{{ costCenterError && costCenterError.cost_center_name || costCenterNotProvided}}</span>
                                    <span v-else></span>
                                </div>

                                <div class="col-5">
                                    <div class="sty-input-wrapper w-100">
                                        <!-- <input type="number" class="sty-inp form-control" style="height: 36px;" v-model="item.cost_center_amount" @keyup.enter="addMoreOnEnterKey(item.id, true)" placeholder="Press Enter To Add More Input" id="faren2"> -->
                                        <input type="number" class="sty-inp form-control" v-model="item.cost_center_amount" @keyup.enter="addMoreCostCenterOnEnterKey" placeholder="Press Enter To Add More Input">
                                    </div>
                                    <span v-if="costCenterError && costCenterError.cost_center_amount || costCenterAmtNotProvided" class="error">{{ costCenterError && costCenterError.cost_center_amount || costCenterAmtNotProvided }}</span>
                                    <span v-else></span>
                                </div>

                                <div class="col-2" v-if="index !== 0">
                                    <div class="sty-input-wrapper w-100 mt-2">
                                        <span @click="removeItem(index)"><i class="fa-solid fa-trash-can text-danger"></i></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <!-- <button type="button" class="btn btn-primary" :disabled="showSave" @click="addRowOnSave">Save</button> -->
                        <button type="button" class="btn btn-primary" :disabled="showSave" @click="addRowOnSaveOnMainModal">Save</button>
                    </div>
                </div>
            </div>
         {% endverbatim %}
        </div>

        <div class="tab-pane fade" id="sale-tab-pane" role="tabpanel" aria-labelledby="sale-tab" tabindex="0">
            <div class="d-flex my-2">
                <h3 class="">Sales Voucher</h3>
                <button type="button" class="ms-auto add-mem-btn" @click="openVoucherModal('sale_voucher')">Create Voucher</button>
            </div>
            {% verbatim %}
            <div>
                <table id="salesVoucherDatatable" class="display dt-table order-column" style="width:100%">
                    <!-- <table id="houseHelpDataTable"> -->
                        <thead>
                            <tr>
                                <th>Actions</th>
                                <th>Id</th>
                                <th>Voucher Type</th>
                                <th>Voucher Name</th>
                                <th>Voucher Number</th>
                                <th>Booking Date</th>
                                <th>Vendor Name</th>
                                <th>Vendor Invoice No.</th>
                                <th>Amount In Words</th>
                                <th>Narration</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item, index) in salesVoucherDatatable" :key="index">
                                <td>
                                    <span @click="viewRequestedData(item.id, 'true')" class="me-3"><i class="fa-solid fa-eye"></i></span>
                                    <span @click="editRequestedData(item.id)"><i class="fa-solid fa-pen-to-square"></i></span>
                                </td>
                                <td v-for="(value, key) in item" :key="key">{{ value }}</td>
                            </tr>
                        </tbody>
                </table>
            </div>
            {% endverbatim %}

            <!-- CREATE MODAL FOR SALES VOUCHER(SVM) -->
            <div class="modal fade" id="salesVoucherCreation" tabindex="-1" aria-labelledby="salesVoucherCreationLabel" data-bs-backdrop="static" aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="heading">Sales Voucher Creation</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        {% verbatim %}
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <select class="w-100 sty-inp form-control" v-model="formData2.voucher_type" @change="fetchVoucherNumber2($event)">
                                            <option value="">Select Voucher Type</option>
                                            <option v-for="voucher in vouchersList" :value="voucher.id">{{ voucher.voucher_name }}</option>
                                        </select>
                                        <label class="sty-label" for="">Voucher Type</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="text" v-model="formData2.voucher_number">
                                        <label class="sty-label" for="">Voucher Number</label>
                                    </div>
                                </div>

                                <input class="sty-inp form-control" type="text" v-model="formData2.suffix" hidden>
                                <input class="sty-inp form-control" type="text" v-model="formData2.prefix" hidden>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="date" v-model="formData2.booking_date">
                                        <label class="sty-label" for="">Booking Date</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <select class="w-100 sty-inp form-control selectLedgerOnSale">
                                            <option value="">Select Ledger</option>
                                            <option v-for="ledger in ledgerList" :value="ledger.id">{{ ledger.ledger_name }}</option>
                                        </select>
                                        <label class="sty-label">Vendor Name</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control w-100" type="date"
                                            v-model="formData2.invoice_date">
                                        <label class="sty-label">Invoice Date</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control w-100" type="text"
                                            v-model="formData2.invoice_number">
                                        <label class="sty-label" for="">Vendor Invoice Number</label>
                                    </div>
                                </div>

                            </div>
                            <hr class="mt-1 mb-3">
                            <div>
                                <table class="table table-sm table-bordered">
                                    <thead class="table-dark">
                                        <tr>
                                            <th style="text-align:center;" width="5%">Select Ledger</th>
                                            <th style="text-align:center;">Quantity</th>
                                            <th style="text-align:center;" width="5%">Rate</th>
                                            <th style="text-align:center;" width="5%">Amount</th>
                                            <th style="text-align:center;" width="5%">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(item, index) in purchases" :key="index">
                                            <td style="text-align:center;" width="5%">
                                                <select class="selectLedgerOnSale" style="width: 50%; border: none; border-color: transparent;">
                                                    <option value="">Select Stock</option>
                                                    <option v-for="shares in sharesList" :value="shares.id">{{ shares.stock_name }}</option>
                                                </select>
                                                <p class="mt-1 text-danger" v-if="errors[index] && errors[index].stock_name">{{  errors[index].ledger_name[0] }}</p>
                                                <span v-else></span>
                                            </td>

                                            <td style="text-align:center;" width="5%">
                                                <input type="text" style="width: 60%; border: none; border-color: transparent;" placeholder="Enter Quantity" v-model="item.quantity" @input="calculateAmount(item)">
                                                <p class="mt-1 text-danger" v-if="errors[index] && errors[index].quantity">{{ errors[index].quantity[0] }}</p>
                                                <span v-else></span>
                                            </td>

                                            <td style="text-align:center;" width="5%">
                                                <input type="text" style="width: 60%; border: none; border-color: transparent;" placeholder="Enter Rate" v-model="item.rate" @input="calculateAmount(item)" @keyup.enter="openCostCenter2(index)" >
                                                <p class="mt-1 text-danger" v-if="errors[index] && errors[index].rate">{{ errors[index].rate[0] }}</p>
                                                <span v-else></span>
                                            </td>

                                            <td style="text-align:center;" width="5%">
                                                <input type="text" style="width: 60%; border: none; border-color: transparent; outline: none;" placeholder="Amount" v-model="item.amount" @keyup.tab.prevent="openCostCenter2(index)" readonly>
                                            </td>

                                            <td style="text-align:center;" width="5%">
                                                <span style="width: 60%; border: none; border-color: transparent;" @click="removeCostCenter(index)" v-if="index !== 0" >
                                                    <i class="fa-solid fa-trash-can text-danger"></i>
                                                </span>
                                                <!-- <span style="width: 60%; border: none; border-color: transparent;" @click="openCostCenterModal(index + 1, item.id)">
                                                    <i class="fa-solid fa-pen"></i>
                                                </span> -->
                                                <span v-if="errors.wing_flat" class="error">{{ errors.wing_flat[0] }}</span>
                                                <span v-else></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th style="text-align:center;" colspan="3">Total</th>
                                            <td style="text-align: center;">
                                                <input type="text" style="width: 50%; border: none; border-color: transparent; outline: none;" placeholder="Total Amount" v-model="formData2.total_purchases" readonly>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>

                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input type="text" class="sty-inp form-control" style="text-transform: capitalize;" v-model="formData2.amount_in_words" readonly>
                                            <label class="sty-label" for="">Amount in Words</label>
                                        </div>
                                    </div>

                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <textarea class="sty-inp form-control" cols="30" rows="1" v-model="formData2.narration"></textarea>
                                            <label class="sty-label" for="">Narration</label>
                                        </div>
                                    </div>

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" @click="saveVoucherDetailsHavingFormData2">Save</button>
                                </div>
                            </div>
                        </div>
                        {% endverbatim %}
                    </div>
                </div>
            </div>

        </div>

        <div class="tab-pane fade" id="journal-tab-pane" role="tabpanel" aria-labelledby="journal-tab" tabindex="0">
            <div class="d-flex my-2">
                <h3 class="">Journal Voucher</h3>
                <button class="ms-auto add-mem-btn" @click="openVoucherModal('general_voucher')">Create Voucher</button>
            </div>

            {% verbatim %}
            <div>
                <table id="generalVoucherDatatable" class="display dt-table order-column" style="width:100%">
                    <!-- <table id="houseHelpDataTable"> -->
                    <thead>
                        <tr>
                            <th>Actions</th>
                            <th>Id</th>
                            <th>Voucher Type</th>
                            <th>Voucher Number</th>
                            <th>Voucher Date</th>
                            <th>Booking Date</th>
                            <th>Amount In Words</th>
                            <th>Narration</th>
                            <th>Cheque No.</th>
                            <th>Cheque Date</th>
                            <!-- <th>Bank Name</th> -->
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, index) in generalVoucherDatatable" :key="index">
                            <td>
                                <span @click="viewRequestedData(item.id)" class="me-3"><i class="fa-solid fa-eye"></i></span>
                                <span @click="editRequestedData(item.id)"><i class="fa-solid fa-pen-to-square"></i></span>
                            </td>
                            <td v-for="(value, key) in item" :key="key">{{ value }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            {% endverbatim %}

            <!-- Create Journal Voucher Modal(JVM) -->
            <div class="modal fade" id="journalVoucherCreate" tabindex="-1" aria-labelledby="journalVoucherLabel" data-bs-backdrop="static" aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="journalVoucherLabel">Journal Voucher Creation</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        {% verbatim %}
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <select class="w-100 sty-inp form-control" v-model="formData.voucher_type" @change="fetchVoucherNumber($event)">
                                            <option value="">Select Voucher Type</option>
                                            <option v-for="voucher in vouchersList" :value="voucher.id">{{ voucher.voucher_name }}</option>
                                        </select>
                                        <label class="sty-label" for="">Voucher Type</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="text" v-model="formData.voucher_number">
                                        <label class="sty-label" for="">Voucher Number</label>
                                    </div>
                                </div>

                                <input class="sty-inp form-control" type="text" v-model="formData.suffix" hidden>
                                <input class="sty-inp form-control" type="text" v-model="formData.prefix" hidden>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="date" v-model="formData.voucher_date" @input="setSameDateAsVoucherDate">
                                        <label class="sty-label" for="">Voucher Date</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="date" v-model="formData.booking_date">
                                        <label class="sty-label" for="">Booking Date</label>
                                    </div>
                                </div>
                            </div>
                            <hr class="mt-1 mb-3">
                            <div>
                                <table class="table table-sm table-bordered">
                                    <thead class="table-dark">
                                        <th style="text-align:center;">Select Type</th>
                                        <th style="text-align:center;">Ledger Name</th>
                                        <th style="text-align:center;">Debit Amount</th>
                                        <th style="text-align:center;">Credit Amount</th>
                                        <th style="text-align:center;">Actions</th>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(item, index) in purchases" :key="index">
                                            <td style="text-align:center;">
                                                <select class="mt-2" style="width: 75%; border: none; border-color: transparent; background-color: white; text-align:center;" v-model="item.payment_option">
                                                    <option value="">Dr/Cr</option>
                                                    <option value="dr">DR</option>
                                                    <option value="cr">CR</option>
                                                </select>
                                            </td>
                                            <td class="text-center">
                                                <select class="selectLedgerOnJournal" style="width: 50%; border: none; border-color: transparent;">
                                                    <option value="">Select Ledger</option>
                                                    <option v-for="ledger in ledgerList" :value="ledger.id">{{ ledger.ledger_name }}</option>
                                                </select>
                                            </td>
                                            <td class="text-center">
                                                <input class="mt-1" v-show="item.payment_option === 'dr'" type="number" style="width: 75%; border: none; border-color: transparent; text-align:center;" v-model="item.debit_amt" placeholder="Enter Debit Amount" @keyup.enter="openRefrenceModal($event, index, 'receipt_voucher')">
                                            </td>
                                            <td class="text-center">
                                                <input class="mt-1" v-show="item.payment_option === 'cr'" type="number" style="width: 75%; border: none; border-color: transparent; text-align:center;" v-model="item.credit_amt" placeholder="Enter Credit Amount" @keyup.enter="openRefrenceModal($event, index, 'receipt_voucher')">
                                            </td>
                                            <td style="display: flex !important; justify-content: center !important; align-items: center !important;">
                                                <span class="ms-auto me-auto" @click="removeCostCenter(index)" v-if="index !== 0">
                                                    <i class="fa-solid mt-2 fs-6 fa-trash-can" style="color: #fa0000"></i>
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th id="total" colspan="2" class="text-center">Total :</th>
                                            <td style="text-align: center" v-model="formData.debit_total">Debit Total: <span class="ms-3">{{ formData.debit_total }}</span></td>
                                            <td style="text-align: center" v-model="formData.credit_total">Credit Total: <span class="ms-3">{{ formData.credit_total }}</span></td>
                                        </tr>
                                    </tbody>
                                </table>

                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input type="text" class="sty-inp form-control" v-model="formData.amount_in_words" style="text-transform: capitalize;">
                                            <label class="sty-label" for="">Amount in Words</label>
                                        </div>
                                    </div>

                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <textarea class="sty-inp form-control" cols="30" rows="1" v-model="formData.narration"></textarea>
                                            <label class="sty-label" for="">Narration</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="text" v-model="formData.cheque_number">
                                            <label class="sty-label" for="">Cheque Number</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="date" v-model="formData.cheque_date">
                                            <label class="sty-label" for="">Date</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="text" v-model="formData.bank_name">
                                            <label class="sty-label" for="">Bank Name</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" @click="saveReceiptVoucherDetails">Save</button>
                                </div>
                            </div>
                        </div>
                        {% endverbatim %}
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="expense-tab-pane" role="tabpanel" aria-labelledby="expense-tab" tabindex="0">
            <div class="d-flex my-2">
                <h3 class="">Expense Voucher</h3>
                <button class="ms-auto add-mem-btn" @click="openVoucherModal('expenses_voucher')" data-bs-toggle="modal" data-bs-target="#expenseVoucherCreate">Create Voucher</button>
            </div>
            {% verbatim %}
            <div>
                <table id="expenseVoucherDatatable" class="display dt-table order-column" style="width:100%">
                    <!-- <table id="houseHelpDataTable"> -->
                    <thead>
                        <tr>
                            <th>Actions</th>
                            <th>Id</th>
                            <th>Voucher Type</th>
                            <th>Voucher Number</th>
                            <th>Voucher Date</th>
                            <th>Booking Date</th>
                            <th>Amount In Words</th>
                            <th>Narration</th>
                            <th>Cheque No.</th>
                            <th>Cheque Date</th>
                            <!-- <th>Bank Name</th> -->
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, index) in expenseVoucherDatatable" :key="index">
                            <td>
                                <span @click="viewRequestedData(item.id)" class="me-3"><i class="fa-solid fa-eye"></i></span>
                                <span @click="editRequestedData(item.id)"><i class="fa-solid fa-pen-to-square"></i></span>
                            </td>
                            <td v-for="(value, key) in item" :key="key">{{ value }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            {% endverbatim %}

            <!-- CREATE MODAL FOR EXPENSE VOUCHER(EVM) -->
            <div class="modal fade" id="expenseVoucherCreate" tabindex="-1" aria-labelledby="expenseVoucherCreateLabel" data-bs-backdrop="static" aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="heading">Expense Voucher Creation</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        {% verbatim %}
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <select class="w-100 sty-inp form-control" v-model="formData.voucher_type" @change="fetchVoucherNumber($event)">
                                            <option value="">Select Voucher Type</option>
                                            <option v-for="voucher in vouchersList" :value="voucher.id">{{ voucher.voucher_name }}</option>
                                        </select>
                                        <label class="sty-label" for="">Voucher Type</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="text" v-model="formData.voucher_number">
                                        <label class="sty-label" for="">Voucher Number</label>
                                    </div>
                                </div>

                                <input class="sty-inp form-control" type="text" v-model="formData.suffix" hidden>
                                <input class="sty-inp form-control" type="text" v-model="formData.prefix" hidden>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="date" v-model="formData.voucher_date" @input="setSameDateAsVoucherDate">
                                        <label class="sty-label" for="">Voucher Date</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="date" v-model="formData.booking_date">
                                        <label class="sty-label" for="">Booking Date</label>
                                    </div>
                                </div>
                            </div>
                            <hr class="mt-1 mb-3">
                            <div>
                                <table class="table table-sm table-bordered">
                                    <thead class="table-dark">
                                        <th style="text-align:center;">Select Type</th>
                                        <th style="text-align:center;">Ledger Name</th>
                                        <th style="text-align:center;">Debit Amount</th>
                                        <th style="text-align:center;">Credit Amount</th>
                                        <th style="text-align:center;">Actions</th>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(item, index) in purchases" :key="index">
                                            <td style="text-align:center;">
                                                <select class="mt-2" style="width: 75%; border: none; border-color: transparent; background-color: white; text-align:center;" v-model="item.payment_option">
                                                    <option value="">Dr/Cr</option>
                                                    <option value="dr">DR</option>
                                                    <option value="cr">CR</option>
                                                </select>
                                            </td>
                                            <td class="text-center">
                                                <select class="selectLedgerOnExpenses" style="width: 50%; border: none; border-color: transparent;">
                                                    <option value="">Select Ledger</option>
                                                    <option v-for="ledger in ledgerList" :value="ledger.id">{{ ledger.ledger_name }}</option>
                                                </select>
                                            </td>
                                            <td class="text-center">
                                                <input class="mt-1" v-show="item.payment_option === 'dr'" type="number" style="width: 75%; border: none; border-color: transparent; text-align:center;" v-model="item.debit_amt" placeholder="Enter Debit Amount" @keyup.enter="addRowOnSaveOnMainModal($event, index, 'receipt_voucher')">
                                            </td>
                                            <td class="text-center">
                                                <input class="mt-1" v-show="item.payment_option === 'cr'" type="number" style="width: 75%; border: none; border-color: transparent; text-align:center;" v-model="item.credit_amt" placeholder="Enter Credit Amount" @keyup.enter="addRowOnSaveOnMainModal($event, index, 'receipt_voucher')">
                                            </td>
                                            <td style="display: flex !important; justify-content: center !important; align-items: center !important;">
                                                <span class="ms-auto me-auto" @click="removeCostCenter(index)" v-if="index !== 0">
                                                    <i class="fa-solid mt-2 fs-6 fa-trash-can" style="color: #fa0000"></i>
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th id="total" colspan="2" class="text-center">Total :</th>
                                            <td style="text-align: center" v-model="formData.debit_total">Debit Total: <span class="ms-3">{{ formData.debit_total }}</span></td>
                                            <td style="text-align: center" v-model="formData.credit_total">Credit Total: <span class="ms-3">{{ formData.credit_total }}</span></td>
                                        </tr>
                                    </tbody>
                                </table>

                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input type="text" class="sty-inp form-control" v-model="formData.amount_in_words" style="text-transform: capitalize;">
                                            <label class="sty-label" for="">Amount in Words</label>
                                        </div>
                                    </div>

                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <textarea class="sty-inp form-control" cols="30" rows="1" v-model="formData.narration"></textarea>
                                            <label class="sty-label" for="">Narration</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="text" v-model="formData.cheque_number">
                                            <label class="sty-label" for="">Cheque Number</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="date" v-model="formData.cheque_date">
                                            <label class="sty-label" for="">Date</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="text" v-model="formData.bank_name">
                                            <label class="sty-label" for="">Bank Name</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" @click="saveReceiptVoucherDetails">Save</button>
                                </div>
                            </div>
                        </div>
                        {% endverbatim %}
                    </div>
                </div>
            </div>

        </div>

        <div class="tab-pane fade" id="income-tab-pane" role="tabpanel" aria-labelledby="income-tab" tabindex="0">
            <div class="d-flex my-2">
                <h3 class="">Income Voucher</h3>
                <button class="ms-auto add-mem-btn" @click="openVoucherModal('income_voucher')">Create Voucher</button>
            </div>
            {% verbatim %}
            <div>
                <table id="incomeVoucherDatatable" class="display dt-table order-column" style="width:100%">
                    <!-- <table id="houseHelpDataTable"> -->
                    <thead>
                        <tr>
                            <th>Actions</th>
                            <th>Id</th>
                            <th>Voucher Type</th>
                            <th>Voucher Number</th>
                            <th>Voucher Date</th>
                            <th>Booking Date</th>
                            <th>Amount In Words</th>
                            <th>Narration</th>
                            <th>Cheque No.</th>
                            <th>Cheque Date</th>
                            <!-- <th>Bank Name</th> -->
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, index) in incomeVoucherDatatable" :key="index">
                            <td>
                                <span @click="viewRequestedData(item.id)" class="me-3"><i class="fa-solid fa-eye"></i></span>
                                <span @click="editRequestedData(item.id)"><i class="fa-solid fa-pen-to-square"></i></span>
                            </td>
                            <td v-for="(value, key) in item" :key="key">{{ value }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            {% endverbatim %}

            <!-- CREATE MODAL FOR INCOME VOUCHER(IVM) -->
            <div class="modal fade" id="incomeVoucherCreate" tabindex="-1" aria-labelledby="incomeVoucherCreateLabel" data-bs-backdrop="static" aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="heading">Income Voucher Creation</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        {% verbatim %}
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <select class="w-100 sty-inp form-control" v-model="formData.voucher_type" @change="fetchVoucherNumber($event)">
                                            <option value="">Select Voucher Type</option>
                                            <option v-for="voucher in vouchersList" :value="voucher.id">{{ voucher.voucher_name }}</option>
                                        </select>
                                        <label class="sty-label" for="">Voucher Type</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="text" v-model="formData.voucher_number">
                                        <label class="sty-label" for="">Voucher Number</label>
                                    </div>
                                </div>

                                <input class="sty-inp form-control" type="text" v-model="formData.suffix" hidden>
                                <input class="sty-inp form-control" type="text" v-model="formData.prefix" hidden>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="date" v-model="formData.voucher_date" @input="setSameDateAsVoucherDate">
                                        <label class="sty-label" for="">Voucher Date</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="date" v-model="formData.booking_date">
                                        <label class="sty-label" for="">Booking Date</label>
                                    </div>
                                </div>
                            </div>
                            <hr class="mt-1 mb-3">
                            <div>
                                <table class="table table-sm table-bordered">
                                    <thead class="table-dark">
                                        <th style="text-align:center;">Select Type</th>
                                        <th style="text-align:center;">Ledger Name</th>
                                        <th style="text-align:center;">Debit Amount</th>
                                        <th style="text-align:center;">Credit Amount</th>
                                        <th style="text-align:center;">Actions</th>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(item, index) in purchases" :key="index">
                                            <td style="text-align:center;">
                                                <select class="mt-2" style="width: 75%; border: none; border-color: transparent; background-color: white; text-align:center;" v-model="item.payment_option">
                                                    <option value="">Dr/Cr</option>
                                                    <option value="dr">DR</option>
                                                    <option value="cr">CR</option>
                                                </select>
                                            </td>
                                            <td class="text-center">
                                                <select class="selectLedgerOnIncome" style="width: 50%; border: none; border-color: transparent;">
                                                    <option value="">Select Ledger</option>
                                                    <option v-for="ledger in ledgerList" :value="ledger.id">{{ ledger.ledger_name }}</option>
                                                </select>
                                            </td>
                                            <td class="text-center">
                                                <input class="mt-1" v-show="item.payment_option === 'dr'" type="number" style="width: 75%; border: none; border-color: transparent; text-align:center;" v-model="item.debit_amt" placeholder="Enter Debit Amount" @keyup.enter="addRowOnSaveOnMainModal($event, index, 'receipt_voucher')">
                                            </td>
                                            <td class="text-center">
                                                <input class="mt-1" v-show="item.payment_option === 'cr'" type="number" style="width: 75%; border: none; border-color: transparent; text-align:center;" v-model="item.credit_amt" placeholder="Enter Credit Amount" @keyup.enter="addRowOnSaveOnMainModal($event, index, 'receipt_voucher')">
                                            </td>
                                            <td style="display: flex !important; justify-content: center !important; align-items: center !important;">
                                                <span class="ms-auto me-auto" @click="removeCostCenter(index)" v-if="index !== 0">
                                                    <i class="fa-solid mt-2 fs-6 fa-trash-can" style="color: #fa0000"></i>
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th id="total" colspan="2" class="text-center">Total :</th>
                                            <td style="text-align: center" v-model="formData.debit_total">Debit Total: <span class="ms-3">{{ formData.debit_total }}</span></td>
                                            <td style="text-align: center" v-model="formData.credit_total">Credit Total: <span class="ms-3">{{ formData.credit_total }}</span></td>
                                        </tr>
                                    </tbody>
                                </table>

                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input type="text" class="sty-inp form-control" v-model="formData.amount_in_words" style="text-transform: capitalize;">
                                            <label class="sty-label" for="">Amount in Words</label>
                                        </div>
                                    </div>

                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <textarea class="sty-inp form-control" cols="30" rows="1" v-model="formData.narration"></textarea>
                                            <label class="sty-label" for="">Narration</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="text" v-model="formData.cheque_number">
                                            <label class="sty-label" for="">Cheque Number</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="date" v-model="formData.cheque_date">
                                            <label class="sty-label" for="">Date</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="text" v-model="formData.bank_name">
                                            <label class="sty-label" for="">Bank Name</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" @click="saveReceiptVoucherDetails">Save</button>
                                </div>
                            </div>
                        </div>
                        {% endverbatim %}
                    </div>
                </div>
            </div>

        </div>

        <div class="tab-pane fade" id="payment-tab-pane" role="tabpanel" aria-labelledby="payment-tab" tabindex="0">

            <div class="d-flex my-2">
                <h3 class="">Payment Voucher</h3>
                <button class="ms-auto add-mem-btn" @click="openVoucherModal('payment_voucher')">Create Voucher</button>
            </div>

            {% verbatim %}
            <div>
                <table id="paymentVoucherDatatable" class="display dt-table order-column" style="width:100%">
                    <!-- <table id="houseHelpDataTable"> -->
                    <thead>
                        <tr>
                            <th>Actions</th>
                            <th>Id</th>
                            <th>Voucher Type</th>
                            <th>Voucher Number</th>
                            <th>Voucher Date</th>
                            <th>Booking Date</th>
                            <th>Amount In Words</th>
                            <th>Narration</th>
                            <th>Cheque No.</th>
                            <th>Cheque Date</th>
                            <!-- <th>Bank Name</th> -->
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, index) in paymentVoucherDatatable" :key="index">
                            <td>
                                <span @click="viewRequestedData(item.id)" class="me-3"><i class="fa-solid fa-eye"></i></span>
                                <span @click="editRequestedData(item.id)"><i class="fa-solid fa-pen-to-square"></i></span>
                            </td>
                            <td v-for="(value, key) in item" :key="key">{{ value }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            {% endverbatim %}

            <!-- Create Payment Voucher Modal(PVM) -->
            <div class="modal fade" id="paymentVoucherCreate" tabindex="-1" aria-labelledby="paymentVoucherLabel" data-bs-backdrop="static" aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="paymentVoucherLabel">Payment Voucher Creation</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        {% verbatim %}
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <select class="w-100 sty-inp form-control" v-model="formData.voucher_type" @change="fetchVoucherNumber($event)">
                                            <option value="">Select Voucher Type</option>
                                            <option v-for="voucher in vouchersList" :value="voucher.id">{{ voucher.voucher_name }}</option>
                                        </select>
                                        <label class="sty-label" for="">Voucher Type</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="text" v-model="formData.voucher_number">
                                        <label class="sty-label" for="">Voucher Number</label>
                                    </div>
                                </div>

                                <input class="sty-inp form-control" type="text" v-model="formData.suffix" hidden>
                                <input class="sty-inp form-control" type="text" v-model="formData.prefix" hidden>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="date" v-model="formData.voucher_date" @input="setSameDateAsVoucherDate">
                                        <label class="sty-label" for="">Voucher Date</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="date" v-model="formData.booking_date">
                                        <label class="sty-label" for="">Booking Date</label>
                                    </div>
                                </div>
                            </div>
                            <hr class="mt-1 mb-3">
                            <div>
                                <table class="table table-sm table-bordered">
                                    <thead class="table-dark">
                                        <th style="text-align:center;">Select Type</th>
                                        <th style="text-align:center;">Ledger Name</th>
                                        <th style="text-align:center;">Debit Amount</th>
                                        <th style="text-align:center;">Credit Amount</th>
                                        <th style="text-align:center;">Actions</th>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(item, index) in purchases" :key="index">
                                            <td style="text-align:center;">
                                                <select class="mt-2" style="width: 75%; border: none; border-color: transparent; background-color: white; text-align:center;" v-model="item.payment_option">
                                                    <option value="">Dr/Cr</option>
                                                    <option value="dr">DR</option>
                                                    <option value="cr">CR</option>
                                                </select>
                                            </td>
                                            <td class="text-center">
                                                <select class="selectLedgerOnPurchase" style="width: 50%; border: none; border-color: transparent;">
                                                    <option value="">Select Ledger</option>
                                                    <option v-for="ledger in ledgerList" :value="ledger.id">{{ ledger.ledger_name }}</option>
                                                </select>
                                            </td>
                                            <td class="text-center">
                                                <input class="mt-1" v-show="item.payment_option === 'dr'" type="number" style="width: 75%; border: none; border-color: transparent; text-align:center;" v-model="item.debit_amt" placeholder="Enter Debit Amount" @keyup.enter="openRefrenceModal($event, index)">
                                            </td>
                                            <td class="text-center">
                                                <input class="mt-1" v-show="item.payment_option === 'cr'" type="number" style="width: 75%; border: none; border-color: transparent; text-align:center;" v-model="item.credit_amt" placeholder="Enter Credit Amount" @keyup.enter="openRefrenceModal($event, index)">
                                            </td>
                                            <td style="display: flex !important; justify-content: center !important; align-items: center !important;">
                                                <span class="ms-auto me-auto" @click="removeCostCenter(index)" v-if="index !== 0">
                                                    <i class="fa-solid mt-2 fs-6 fa-trash-can" style="color: #fa0000"></i>
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th id="total" colspan="2" class="text-center">Total :</th>
                                            <td style="text-align: center" v-model="formData.debit_total">Debit Total: <span class="ms-3">{{ formData.debit_total }}</span></td>
                                            <td style="text-align: center" v-model="formData.credit_total">Credit Total: <span class="ms-3">{{ formData.credit_total }}</span></td>
                                        </tr>
                                    </tbody>
                                </table>

                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input type="text" class="sty-inp form-control" style="text-transform: capitalize;" v-model="formData.amount_in_words" readonly>
                                            <label class="sty-label" for="">Amount in Words</label>
                                        </div>
                                    </div>

                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <textarea class="sty-inp form-control" cols="30" rows="1" v-model="formData.narration"></textarea>
                                            <label class="sty-label" for="">Narration</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="text" v-model="formData.cheque_number">
                                            <label class="sty-label" for="">Cheque Number</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="date" v-model="formData.cheque_date">
                                            <label class="sty-label" for="">Date</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="text" v-model="formData.bank_name">
                                            <label class="sty-label" for="">Bank Name</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" @click="saveReceiptVoucherDetails">Save</button>
                                </div>
                            </div>
                        </div>
                        {% endverbatim %}
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="receipt-tab-pane" role="tabpanel" aria-labelledby="receipt-tab" tabindex="0">

            <div class="d-flex my-2">
                <h3 class="">Receipt Voucher</h3>
                <button class="ms-auto add-mem-btn" @click="openVoucherModal('receipt_voucher')">Create Voucher</button>
            </div>

            {% verbatim %}
            <div>
                <table id="receiptVoucherDatatable" class="display dt-table order-column" style="width:100%">
                    <!-- <table id="houseHelpDataTable"> -->
                    <thead>
                        <tr>
                            <th>Actions</th>
                            <th>Id</th>
                            <th>Voucher Type</th>
                            <th>Voucher Number</th>
                            <th>Voucher Date</th>
                            <th>Booking Date</th>
                            <th>Amount In Words</th>
                            <th>Narration</th>
                            <th>Cheque No.</th>
                            <th>Cheque Date</th>
                            <!-- <th>Bank Name</th> -->
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, index) in receiptVoucherDatatable" :key="index">
                            <td>
                                <span @click="viewRequestedData(item.id)" class="me-3"><i class="fa-solid fa-eye"></i></span>
                                <span @click="editRequestedData(item.id)"><i class="fa-solid fa-pen-to-square"></i></span>
                            </td>
                            <td v-for="(value, key) in item" :key="key">{{ value }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            {% endverbatim %}

            <!-- Create Receipt Voucher Modal(RVM) -->
            <div class="modal fade" id="receiptVoucherCreate" tabindex="-1" aria-labelledby="receiptVoucherLabel" data-bs-backdrop="static" aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="receiptVoucherLabel">Receipt Voucher Creation</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        {% verbatim %}
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <select class="w-100 sty-inp form-control" v-model="formData.voucher_type" @change="fetchVoucherNumber($event)">
                                            <option value="">Select Voucher Type</option>
                                            <option v-for="voucher in vouchersList" :value="voucher.id">{{ voucher.voucher_name }}</option>
                                        </select>
                                        <label class="sty-label" for="">Voucher Type</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="text" v-model="formData.voucher_number">
                                        <label class="sty-label" for="">Voucher Number</label>
                                    </div>
                                </div>

                                <input class="sty-inp form-control" type="text" v-model="formData.suffix" hidden>
                                <input class="sty-inp form-control" type="text" v-model="formData.prefix" hidden>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="date" v-model="formData.voucher_date" @input="setSameDateAsVoucherDate">
                                        <label class="sty-label" for="">Voucher Date</label>
                                    </div>
                                </div>

                                <div class="col-lg-4 mb-3">
                                    <div class="sty-input-wrapper w-100">
                                        <input class="sty-inp form-control" type="date" v-model="formData.booking_date">
                                        <label class="sty-label" for="">Booking Date</label>
                                    </div>
                                </div>
                            </div>
                            <hr class="mt-1 mb-3">
                            <div>
                                <table class="table table-sm table-bordered">
                                    <thead class="table-dark">
                                        <th style="text-align:center;">Select Type</th>
                                        <th style="text-align:center;">Ledger Name</th>
                                        <th style="text-align:center;">Debit Amount</th>
                                        <th style="text-align:center;">Credit Amount</th>
                                        <th style="text-align:center;">Actions</th>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(item, index) in purchases" :key="index">
                                            <td style="text-align:center;">
                                                <select class="mt-2" style="width: 75%; border: none; border-color: transparent; background-color: white; text-align:center;" v-model="item.payment_option">
                                                    <option value="">Dr/Cr</option>
                                                    <option value="dr">DR</option>
                                                    <option value="cr">CR</option>
                                                </select>
                                            </td>
                                            <td class="text-center">
                                                <select id="ledgerSelect" class="selectLedgerOnReceipt" style="width: 50%; border: none; border-color: transparent;">
                                                    <option value="">Select Ledger</option>
                                                    <option v-for="ledger in ledgerList" :value="ledger.id">{{ ledger.ledger_name }}</option>
                                                </select>
                                            </td>
                                            <td class="text-center">
                                                <input class="mt-1" v-show="item.payment_option === 'dr'" type="number" style="width: 75%; border: none; border-color: transparent; text-align:center;" v-model="item.debit_amt" placeholder="Enter Debit Amount" @keyup.enter="openRefrenceModal($event, index, 'receipt_voucher', document.getElementById('ledgerSelect').value)">
                                            </td>
                                            <td class="text-center">
                                                <input class="mt-1" v-show="item.payment_option === 'cr'" type="number" style="width: 75%; border: none; border-color: transparent; text-align:center;" v-model="item.credit_amt" placeholder="Enter Credit Amount" @keyup.enter="openRefrenceModal($event, index, 'receipt_voucher', document.getElementById('ledgerSelect').value)">
                                            </td>
                                            <td style="display: flex !important; justify-content: center !important; align-items: center !important;">
                                                <span class="ms-auto me-auto" @click="removeCostCenter(index)" v-if="index !== 0">
                                                    <i class="fa-solid mt-2 fs-6 fa-trash-can" style="color: #fa0000"></i>
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th id="total" colspan="2" class="text-center">Total :</th>
                                            <td style="text-align: center" v-model="formData.debit_total">Debit Total: <span class="ms-3">{{ formData.debit_total }}</span></td>
                                            <td style="text-align: center" v-model="formData.credit_total">Credit Total: <span class="ms-3">{{ formData.credit_total }}</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                                <!-- <div class="row">
                                    <div class="col-1 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <select name="" class="sty-inp form-control">
                                                <option value="dr">DR</option>
                                                <option value="cr">CR</option>
                                            </select>
                                            <label class="sty-label" for="">DR/CR</label>
                                        </div>
                                    </div>

                                    <div class="col-2 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <select class="sty-inp form-control" name="" id="">
                                                <option value="">Bank</option>
                                                <option value="">Cash</option>
                                            </select>
                                            <label for="" class="sty-label">Bank/Cash</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-2 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <select class="sty-inp form-control" name="" id="">
                                                <option value="">Ledger 1</option>
                                                <option value="">Ledger 2</option>
                                                <option value="">Ledger 3</option>
                                            </select>
                                            <label class="sty-label" for="">Ledger Name</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-2 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input type="number" class="sty-inp form-control" name="">
                                            <label class="sty-label" for="">Debit Amount</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-2 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input type="number" class="sty-inp form-control" name="">
                                            <label class="sty-label" for="">Credit Amount</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-2 mb-3">
                                        <button class="btn btn-primary">
                                            Against Reference
                                        </button>
                                    </div>

                                    <div class="col-lg-1 mb-3">
                                        <button class="btn btn-primary">
                                            Cost
                                        </button>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-2 mb-3">
                                        <button class="btn btn-primary" type="button">Add More</button>
                                    </div>
                                    <div class="col-3 mb-3">
                                    </div>
                                    <div class="col-lg-2 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="number" @keyup.enter="openCostCenterModal(index)">
                                            <label class="sty-label" for="">Debit Total Amount</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-2 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="number">
                                            <label class="sty-label" for="">Credit Total Amount</label>
                                        </div>
                                    </div>
                                </div> -->

                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input type="text" class="sty-inp form-control" style="text-transform: capitalize;" v-model="formData.amount_in_words" readonly>
                                            <label class="sty-label" for="">Amount in Words</label>
                                        </div>
                                    </div>

                                    <div class="col-6 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <textarea class="sty-inp form-control" cols="30" rows="1" v-model="formData.narration"></textarea>
                                            <label class="sty-label" for="">Narration</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="text" v-model="formData.cheque_number">
                                            <label class="sty-label" for="">Cheque Number</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="date" v-model="formData.cheque_date">
                                            <label class="sty-label" for="">Date</label>
                                        </div>
                                    </div>

                                    <div class="col-lg-4 mb-3">
                                        <div class="sty-input-wrapper w-100">
                                            <input class="sty-inp form-control" type="text" v-model="formData.bank_name">
                                            <label class="sty-label" for="">Bank Name</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" @click="saveReceiptVoucherDetails">Save</button>
                                </div>
                            </div>
                        </div>
                        {% endverbatim %}
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script> -->

<script>
    let datatable_columns = {{ datatable_columns }};
</script>

<script>

// DATATABLE FOR PURCHASE & SALE
/* DATATABLE */
$(document).ready(function () {
    // Adjust column sizes when a tab is shown
    $('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
        // $($.fn.dataTable.tables(true)).DataTable()
        //     .columns.adjust();
        setTimeout(function() {
           $($.fn.dataTable.tables(true)).DataTable().columns.adjust();
        }, 3000); // Adjust the delay as needed
    });

    var table = $('#costCenterDatatable, #purchaseVoucherDatatable, #salesVoucherDatatable, #generalVoucherDatatable, #expenseVoucherDatatable, #incomeVoucherDatatable, #paymentVoucherDatatable, #receiptVoucherDatatable').DataTable({
        "dom": '<"dt-buttons"Br><"clear">ftipl',
        buttons: [
            {
                extend: 'colvis',
                text: 'More Column',
                postfixButtons: [
                    'colvisRestore'
                ]
            },
            {
                extend: 'searchBuilder',
                text: 'Filter'
            },
            {
                extend: 'print',
                exportOptions: {
                    // columns: ':visible',
                    columns: ':visible:not(.exclude-print)', // Exclude columns with the class 'exclude-print'
                    modifier: { search: 'applied', order: 'applied' },

                }
            },
            {
                extend: 'print',
                text: 'Print All',
                exportOptions: {
                    columns: '*:not(.exclude-print)' // Exclude columns with the class 'exclude-print'
                    // modifier: { search: 'applied', order: 'applied' },

                }
            },
        ],

        order: [],
        "stripeClasses": [],

        columnDefs: [

            { "visible": true, "targets": datatable_columns },
            { "visible": false, "targets": [1,2] },
        ],
        fixedColumns: {
            left: 2
        },
        // "paging": true,
        // 'pageLength': '5',
        pagingType: "simple",
        paginate: {
            previous: "<",
            next: ">"
        },
        scrollCollapse: false,
        scrollX: true
    });

    $('#costCenterDatatable_info, #purchaseVoucherDatatable_info, #salesVoucherDatatable_info, #generalVoucherDatatable_info, #expenseVoucherDatatable_info, #incomeVoucherDatatable_info, #paymentVoucherDatatable_info, #receiptVoucherDatatable_info').css({
        'text-align': 'center',
        'position': 'relative',
        'left': '40%',
        'padding-top': '20px',
        'display': 'block'
    });

    // Adjust the info text position when the table is redrawn
    table.on('draw.dt', function () {
        $('#costCenterDatatable_info, #purchaseVoucherDatatable_info, #salesVoucherDatatable_info, #generalVoucherDatatable_info, #expenseVoucherDatatable_info, #incomeVoucherDatatable_info, #paymentVoucherDatatable_info, #receiptVoucherDatatable_info').css({
            'text-align': 'center',
            'margin-left': 'auto',
            'margin-right': 'auto'
        });
    });

    // Adjust column sizes for all tables after initialization with a slight delay
        setTimeout(function() {
            $($.fn.dataTable.tables(true)).DataTable().columns.adjust();
        }, 3000); // Adjust the delay as needed
    });
    // Ensure columns adjust after the window has fully loaded
    $(window).on('load', function() {
        $($.fn.dataTable.tables(true)).DataTable().columns.adjust();
});






Vue.directive('select2', {
    inserted(el, binding, vnode) {
        $(el).select2({
            dropdownParent: $('#CostCenterModal'),
            width: '100%'
        });
    },
    componentUpdated(el, binding, vnode) {
        $(el).trigger('change'); // Re-trigger the change event to update the select2 state
    },
    unbind(el, binding, vnode) {
        $(el).select2('destroy'); // Destroy Select2 instance
    }
});


new Vue({
    el: '#costCenterEntirePage',
    data: {
        purchases: [{}],
        costCenterData: [],
        vouchersList: [],
        ledgerList: [],
        items: [{
            id: '',
            cost_center_name: '',
            cost_center_amount: null,
        }],
        selectedBillNames: [],
        showSave: false,
        formData: {
            voucher_type: '',
            voucher_number: '',
            booking_date: '',
            prefix: '',
            suffix: ''
        },
        formData2: {
            voucher_type: '',
            voucher_number: '',
            totalAmountValue: null,
            prefix: '',
            suffix: ''
        },
        costCenterError: {

        },
        displayAmount: null,
        totalAmountValue: 0,
        errors: {},
        subGroups: [],
        groupError: {},
        countries: [],
        states: [],
        cities: [],
        errors: {},
        subGroupsOnGroupModal: [],
        name: '',
        parent: '',
        superParent: '',
        nextId: 1,
        costCenterNotProvided: '',
        costCenterAmtNotProvided: '',
        totalAmount: 0,
        amountMatchedError: '',
        addRowOnSaveVar: false,
        completeJSON: {
            related_ledgers: [],
        },
        stockJson:{
            stocks: [],
        },
        indexNumber: 0,
        voucher_type_to_open: '',
        modalNameToOpen: '',
        className: '',
        addShares: false,
        sharesList: [],
        sharesData: {
            stock_name: '',
            stock_type: 'Select Stock Type'
        },
        purchaseVoucherDatatable: {},
        salesVoucherDatatable: {},
        generalVoucherDatatable: {},
        expenseVoucherDatatable: {},
        incomeVoucherDatatable: {},
        paymentVoucherDatatable: {},
        receiptVoucherDatatable: {},
        showVoucherDetails: {},
        showRelatedLedgers: {},
        showStocks: {},
        againstRefrences: [],
        already_traversed_ledgers: [],
        showAgainstRefrence: [],
        isPurchaseSaleVoucher: false,
        //againstRefrences: [
        //    {
        //        'against_voucher': 1,
        //        'voucher_number': 'VOUCHER-123-2024',
        //        'voucher_date': '2000-09-09',
        //        'pending_amt': 200,
        //        'final_amt': 500,
        //        'allocated_amt': null
        //    },
        //    {
        //        'against_voucher': 2,
        //        'voucher_number': 'VOUCHER-456-2024',
        //        'voucher_date': '2000-09-09',
        //        'pending_amt': 300,
        //        'final_amt': 500,
        //        'allocated_amt': null
        //    },
        //]
    },
    methods: {
        // EXTRA
        addMore() {

        },
        updateSubGroups(event, calling_from_update=false){
            this.subGroupsOnGroupModal = [];
            event = event;
            if(!calling_from_update){
                event = event.target.value
            }
            //if(!event.target.value){
            if(!event){
                this.subGroupsOnGroupModal = '';
                return;
            }
            axios.defaults.xsrfCookieName = 'csrftoken';
            axios.defaults.xsrfHeaderName = 'X-CSRFToken';
            //axios.get(`http://127.0.0.1:8000/api/ledger_group/${event.target.value}`)
            axios.get(`http://127.0.0.1:8000/api/ledger_group/${event}`)
            .then(response => {
                    this.subGroupsOnGroupModal = response.data.sub_group;
                })
                .catch(error => {
                    console.error('Error fetching data in getting group:', error);
                });
        },
        groupCreationModalClose(){
            $('#groupCreationModal').modal('hide');
            $('#createNewLedger').modal('show');
        },
        submitGroup(id){
            function toTitleCase(str) {
                return str.replace(
                    /\w\S*/g,
                    function(txt) {
                    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                    }
                );
            }

            axios.defaults.xsrfCookieName = 'csrftoken';
            axios.defaults.xsrfHeaderName = 'X-CSRFToken';

            this.parent = $('#groupSelection').val();
            console.log("SELECTED ELEMENT======", this.parent);
            data = {
                "name": toTitleCase(this.name),
                "superParent": this.superParent,
                "parent": this.parent
            }

            axios.post('http://127.0.0.1:8000/api/leadger_group_creation/', data)
                .then(response => {
                    console.log("Response-->", response.data);
                    $("#groupSelection").val('').trigger('change');
                    this.name = '';
                    this.errors = {}
                    toastr.options = {
                        closeButton: true,
                        positionClass: 'toast-top-center',
                        timeOut: 5000
                    };
                    toastr.success(response.message, "Group Added Successfully!");
                    $('#groupCreationModal').modal('hide');
                    $('#createNewLedger').modal('show');
                    this.subGroupsOnGroupModal.push(response.data.name);
                })
                .catch(error => {
                    console.log("Errors -->", error.response.data);
                    this.errors = error.response.data;
                    toastr.options = {
                        closeButton: true,
                        positionClass: 'toast-top-center',
                        timeOut: 2000
                    };
                    toastr.error("Please Correct All Errors!");
                    if(this.errors.sub_group_error){
                        toastr.error("Sub Group Does Not Exists, Please Refresh The Page And Try Again!");
                    }
                });
        },
        // EXTRA
        submitShares(){
            axios.post(`http://127.0.0.1:8000/api/shares_on_ledger_creation/`, this.sharesData)
                .then(response => {
                    toastr.options = {
                        closeButton: true,
                        positionClass: 'toast-top-center',
                        timeOut: 5000
                    };
                    toastr.success("Shares Details Added!");
                    this.sharesList.push(response.data);
                    $(`#createShareModal`).modal('hide');
                    $(`#${this.modalNameToOpen}`).modal('show');
                })
                .catch(error => {
                    this.errors = error.response.data;
                    console.error('Error fetching shares data:', this.errors);
                });
        },
        initializeSelect2($element, dropdown) {
            let buttonName = 'Ledger';
            let addShares = this.addShares;
            let modalName = this.modalNameToOpen;
            if(this.addShares){
                buttonName = 'Stock'
            }
            $element.select2({
                dropdownParent: $(`#${dropdown}`),
                width: '100%',
            }).on('select2:open', () => {
                $(".select2-results:not(:has(button.create-button))").append(`<button class="create-button btn">+ Create New ${buttonName}</button>`);
                $('.select2-results').on('click', 'button.create-button', function () {
                    $(`#${modalName}`).modal('hide');
                    if(!addShares){
                        $('#createNewLedger').modal('show');

                        axios.get(`http://127.0.0.1:8000/api/ledger_group/all/`)
                        .then(response => {
                            this.subGroups = response.data.sub_group;
                            console.log("data==============", this.subGroups);
                            $('#ledgerSelection').select2({
                                dropdownParent: $('#createNewLedger'),
                                width: '100%',
                                }).on('select2:open', () => {
                                    $(".select2-results:not(:has(button.create-button))").append('<button class="create-button btn">+ Create New Group</button>');
                                    $('.select2-results').on('click', 'button.create-button', function () {
                                        $('#createNewLedger').modal('hide');
                                        $('#groupCreationModal').modal('show');
                                        $('#groupSelection').select2({
                                            dropdownParent: $('#groupCreationModal'),
                                            width: '100%',
                                        });
                                    });
                                });
                        })
                        .catch(error => {
                            console.error('Error fetching data:', error);
                        });
                    }else{
                        $('#createShareModal').modal('show');
                    }
                });
            });
        },
        addRowOnSave(){
            //this.addRowOnSaveVar = false;
            this.addMoreOnEnterKey('', false);
            if(this.addRowOnSaveVar){
                $('#CostCenterModal').modal('hide');
                $('#purchaseVoucherCreate').modal('show');

                this.items.forEach(item => {
                    const select2Refrence = this.$refs[`select2-${item.id}`];
                    $(select2Refrence).select2();
                    const selectedValue = $(select2Refrence).val();
                    console.log(`ID: ${item.id}, Cost Center Name: ${selectedValue}, Cost Center Amount: ${item.cost_center_amount}`);
                });
                this.items = [{}];
                this.totalAmount = 0;
                //this.nextId = 1;

                this.purchases.push({
                    ledger_name: '',
                    quantity: '',
                    rate: '',
                    amount: ''
                });
                this.$nextTick(() => {
                    this.initializeSelect2($('.selectLedger'), 'purchaseVoucherCreate');
                });
            }
        },

        addMoreOnEnterKey(item, flag) {
            this.amountMatchedError = '';
            this.costCenterNotProvided = '';
            this.costCenterAmtNotProvided = '';
            let select2Ref = this.$refs[`select2-${item}`];
            let selectedValue = $(select2Ref).val();
            if(!item){
                item = 0;
            }

            if(!selectedValue){
                this.addRowOnSaveVar = false;
                this.costCenterNotProvided = "This field cannot be empty."
            }
            if(this.items[item]['cost_center_amount'] === null){
                this.addRowOnSaveVar = false;
                this.costCenterAmtNotProvided = "This field cannot be empty."
            }
            if(this.items[item]['cost_center_amount'] !== null ){
                //this.totalAmount = this.totalAmount + parseFloat(this.items[item]['cost_center_amount']);
                this.totalAmount = this.items.reduce((acc, item) => {
                    const amount = parseFloat(item.cost_center_amount) || 0;
                    return acc + amount;
                }, 0);
                console.log("total amot==", this.totalAmount);
                if(this.totalAmount > parseFloat(this.displayAmount)){
                    this.addRowOnSaveVar = false;
                    this.costCenterAmtNotProvided = "Given amount should be equal or less than total amount."
                }
                else if(this.totalAmount === parseFloat(this.displayAmount)){
                    this.amountMatchedError = "Can't add more cost center, it cannot exceed the total amount."
                }
            }

            if(selectedValue && (this.items[item]['cost_center_amount'] !== null && this.totalAmount < parseFloat(this.displayAmount))){
                this.addRowOnSaveVar = true;
                //this.costCenterNotProvided = '';
                //this.costCenterAmtNotProvided = '';
                if(flag){
                    this.items.push({
                        id: this.nextId++,
                        cost_center_name: '',
                        cost_center_amount: null
                    });
                }
            }
        },
        removeItem(index, id) {
            // TRY DESTROYING THE SELECT2 BEFORE REMOVING THE ROW
            this.items.splice(index, 1);
        },
        setSameDateAsVoucherDate(){
            if(!this.formData.booking_date){
                this.formData.booking_date = this.formData.voucher_date;
            }
        },
        // countOccurrencesOfLedger(array, element) {
        //     return array.reduce((count, currentElement) => {
        //         return currentElement === element ? count + 1 : count;
        //     }, 0);
        // },
        openRefrenceModal(event, index, voucher_type, ledger_id){
            this.againstRefrences = [];
            this.indexNumber = index;
            let ledger_name = parseInt(document.querySelectorAll(`.${this.className}`)[index].value)

            // Get bills from general ledger
            axios.get(`http://127.0.0.1:8000/api/against_refrence/?ledger=${ledger_name}`)
                .then(response => {
                    let newRefrence = [];
                    // To get the already created against refrence data, if present
                    let newArray = this.completeJSON.related_ledgers;
                    newArray.forEach(item => {
                        const ledgerName = item.ledger_name;
                        if (ledgerName === ledger_name){
                            newRefrence = item.against_refrence;
                        }
                    });

                    if (newRefrence.length === 0) {
                        this.againstRefrences = response.data;
                    }else{
                        this.againstRefrences = newRefrence;
                    }

                    $(`#${this.modalNameToOpen}`).modal('hide');
                    $('#addRefrenceModal').modal('show');
                })
                .catch(error => {
                    this.totalForFormData2()
                    this.totalAmountOnTable()
                    this.purchases.push({
                        payment_option: '',
                    });

                    this.$nextTick(() => {
                        this.initializeSelect2($(`.${this.className}`), this.modalNameToOpen);
                    });
                })
                .finally(() => {
                    this.purchases[index]['ledger_name'] = ledger_name;
                    related_ledgers = this.purchases[index];
                    related_ledgers['against_refrence'] = []
                    related_ledgers['cost_center'] = []
                    this.completeJSON['related_ledgers'].push(related_ledgers);
                });
        },
        closeRefrenceModal(){
            $('#receiptVoucherCreate').modal('show');
            $('#addRefrenceModal').modal('hide');
        },
        totalForFormData2(){
            let total_amount = 0;
            this.purchases.forEach(item => {
                console.log("item.totalAmountValue=========", item.amount)
                if (!isNaN(parseFloat(item.amount))) {
                    total_amount += parseFloat(item.amount);
                }
            });
            this.totalAmountValue = total_amount;
            this.formData2.amount_in_words = window.numberToWords.toWords(this.totalAmountValue);
        },
        stockTotalAmt(){
            let stockSum = 0;
            this.purchases.forEach(item => {
                if (!isNaN(parseFloat(item.amount))) {
                    stockSum += parseFloat(item.amount);
                }
            });
            this.formData2.total_purchases = stockSum;
            this.formData2.total_sales = stockSum;
            this.formData2.amount_in_words = window.numberToWords.toWords(stockSum);
        },
        openCostCenter2(index){
            this.indexNumber = index;
            this.purchases[index]['stock_name'] = parseInt(document.querySelectorAll(`.${this.className}`)[index + 1].value);
            this.stockJson['stocks'].push(this.purchases[index]);
            this.stockTotalAmt();
            this.purchases.push({
                payment_option: '',
            });
            this.$nextTick(() => {
                this.initializeSelect2($(`.${this.className}`), this.modalNameToOpen);
            });

            // USEFULL FOR SALES, PURCHASE, ETC.
            // $(`#${this.modalNameToOpen}`).modal('hide');
            // $('#CostCenterModal').modal('show');

            // related_ledgers = this.purchases[index];
            // related_ledgers['cost_center'] = []


            //this.items = [{
            //    cost_center_name: '',
            //    cost_center_amount: null
            //}]
            //axios.get(`http://127.0.0.1:8000/api/cost_center/`)
            //    .then(response => {
            //        this.costCenterData = response.data;
            //    })
            //    .catch(error => {
            //        console.error('Error fetching data:', error);
            //    });
        },
        openCostCenter(){
            // SAVE AGAINST REFRENCE IN BEFORE OPENING COST CENTER.
            this.againstRefrences.forEach(item => {
                let pending_amt;
                if(item.allocated_amt){
                    pending_amt = item.pending_amt - parseFloat(item.allocated_amt)
                }
                console.log("pending_amt:", pending_amt);
                let against_refrences = {
                    'against_voucher': item.against_voucher,
                    'voucher_number': item.voucher_number,
                    'voucher_date': item.voucher_date,
                    'pending_amt': pending_amt,
                    'final_amt': item.final_amt,
                    'allocated_amt': parseFloat(item.allocated_amt)
                }
                this.completeJSON.related_ledgers[this.indexNumber]['against_refrence'].push(against_refrences);
            });
            console.log("complete json print is===============>", this.completeJSON)

            $('#addRefrenceModal').modal('hide');
            // $('#CostCenterModal').modal('show');
            $(`#${this.modalNameToOpen}`).modal('show');

            this.totalForFormData2()
            this.totalAmountOnTable()
            this.purchases.push({
                payment_option: '',
            });

            this.$nextTick(() => {
                this.initializeSelect2($(`.${this.className}`), this.modalNameToOpen);
            });

            // HARDCODING THIS, WHEN VOUCHER NUMBER ACTUAL DATA WILL COME UNCOMMENT BELOW CODE AND REMOVE UNCOMMENTED CODE
            // this.againstRefrences = {};

            //this.$nextTick(() => {
            //    this.initializeSelect2ForCostCenter($('.costCenterSelect2'), 'CostCenterModal');
            //});

            //this.items = [{
            //    cost_center_name: '',
            //    cost_center_amount: null
            //}]
            //axios.get(`http://127.0.0.1:8000/api/cost_center/`)
            //    .then(response => {
            //        this.costCenterData = response.data;
            //    })
            //    .catch(error => {
            //        console.error('Error fetching data:', error);
            //    });
        },
        totalAmountOnTable() {
            let debit_amt = 0;
            let credit_amt = 0;
            this.purchases.forEach(item => {
                if (!isNaN(parseFloat(item.debit_amt))) {
                    debit_amt += parseFloat(item.debit_amt);
                }
                // Check if item.credit_amt is a valid number
                if (!isNaN(parseFloat(item.credit_amt))) {
                    credit_amt += parseFloat(item.credit_amt);
                }
            });
            this.formData.debit_total = debit_amt;
            this.formData.credit_total = credit_amt;
            // this.totalAmountValue = total_amount;
            this.formData.amount_in_words = window.numberToWords.toWords(debit_amt);
        },
        addRowOnSaveOnMainModal(event, index){
            // let index = this.indexNumber;
            // ADD COST CENTER BRFORE ADDING ANOTHER ROW
            // this.items.forEach(item => {
            //     let cost_center = {
            //         'cost_center': item.cost_center_name,
            //         'amount': item.cost_center_amount,
            //     }
            //     this.completeJSON.related_ledgers[this.indexNumber]['cost_center'].push(cost_center);
            // });

            // console.log("final==========", this.completeJSON.related_ledgers[this.indexNumber]['cost_center'])

            // $('.costCenterSelect2').select2('destroy');
            // this.items = [{}];

            // $('#CostCenterModal').modal('hide');
            // $(`#${this.modalNameToOpen}`).modal('show');

            this.purchases[index]['ledger_name'] = parseInt(document.querySelectorAll(`.${this.className}`)[index].value);
            console.log("payment options===================", this.purchases[index]);
            related_ledgers = this.purchases[index];
            related_ledgers['against_refrence'] = []
            related_ledgers['cost_center'] = []
            this.completeJSON['related_ledgers'].push(related_ledgers);


            this.totalForFormData2()
            this.totalAmountOnTable()
            this.purchases.push({
                payment_option: '',
            });
            this.$nextTick(() => {
                this.initializeSelect2($(`.${this.className}`), this.modalNameToOpen);
            });
        },
        saveReceiptVoucherDetails(){
            this.completeJSON['voucher_name'] = this.voucher_type_to_open;
            for (const key in this.formData) {
                if (Object.prototype.hasOwnProperty.call(this.formData, key)) {
                    if (this.formData[key] !== null) {
                        this.completeJSON[key] = this.formData[key];
                    }
                }
            }
            console.log("Final data===========", this.completeJSON)

            axios.post(`http://127.0.0.1:8000/api/voucher_create_ledger/`, this.completeJSON)
                .then(response => {
                    console.log("Success", response.data);
                    toastr.options = {
                            closeButton: true,
                            positionClass: 'toast-top-center',
                            timeOut: 5000
                        };
                    toastr.success("Voucher Added Successfully!");
                    // setTimeout(function() {
                    //     location.reload();
                    // }, 600);
                })
                .catch(error => {
                    console.log("Error", error.response.data);
                    toastr.options = {
                            closeButton: true,
                            positionClass: 'toast-top-center',
                            timeOut: 5000
                        };
                    toastr.error("Something went wrong, try again!!");
                });
        },
        saveVoucherDetailsHavingFormData2(){
            this.stockJson['voucher_name'] = this.voucher_type_to_open;
            this.stockJson['vendor_name'] = document.getElementsByClassName(this.className)[0].value;
            for (const key in this.formData2) {
                if (Object.prototype.hasOwnProperty.call(this.formData2, key)) {
                    if (this.formData2[key] !== null) {
                        this.stockJson[key] = this.formData2[key];
                    }
                }
            }
            console.log("Final data===========", this.stockJson)

            axios.post(`http://127.0.0.1:8000/api/voucher_create_purchase_sale/`, this.stockJson)
                .then(response => {
                    console.log("Success", response.data)
                })
                .catch(error => {
                    console.log("Error", error.response.data)
                });
        },
        addMoreCostCenterOnEnterKey(){
            this.items.push({
                id: '',
                cost_center_name: '',
                cost_center_amount: null,
            });
            this.$nextTick(() => {
                this.initializeSelect2ForCostCenter($('.costCenterSelect2'), 'CostCenterModal');
            });
        },
        initializeSelect2ForCostCenter($element, dropdown) {
            $element.select2({
                dropdownParent: $(`#${dropdown}`),
                width: '100%',
            })
        },
        openCostCenterModal(index) {
            this.errors = {};
            this.displayAmount = this.purchases[index]['amount'];
            this.purchases[index]['ledger_name'] = parseInt(document.getElementsByClassName(this.className)[index + 1].value);

            axios.post(`http://127.0.0.1:8000/api/purchase_voucher_creation/`, this.purchases[index])
                .then(response => {
                    $('#CostCenterModal').modal('show');
                    $('#purchaseVoucherCreate').modal('hide');
                    axios.get(`http://127.0.0.1:8000/api/cost_center/`)
                        .then(response => {
                            this.costCenterData = response.data;
                        })
                        .catch(error => {
                            console.error('Error fetching data:', error);
                        });

                    // INITIALIZING SELECT2 FOR COST CENTER
                    $('.groupSelectionUpdate').select2({
                        dropdownParent: $('#CostCenterModal'),
                        width: '100%',
                    });
                })
                .catch(error => {
                    this.$set(this.errors, index, error.response.data);
                });
        },
        destroySelect2(){
            $('#purchaseVoucherCreate').modal('hide');
            $('.selectLedger').select2('destroy');
        },
        openVoucherModal(modalName) {
            //this.completeJSON = {};
            this.purchases = [{
                'payment_option': ''
            }]
            if(modalName === 'purchase_voucher'){
                this.addShares = true;
                this.voucher_type_to_open = modalName;
                this.modalNameToOpen = "purchaseVoucherCreate";
                this.className = 'selectLedger';
                $(`#${this.modalNameToOpen}`).modal('show');
            }
            if(modalName === 'sale_voucher'){
                this.addShares = true;
                this.voucher_type_to_open = modalName;
                this.modalNameToOpen = "salesVoucherCreation";
                this.className = 'selectLedgerOnSale';
                $(`#${this.modalNameToOpen}`).modal('show');
            }
            if(modalName === 'general_voucher'){
                this.addShares = false;
                this.voucher_type_to_open = modalName;
                this.modalNameToOpen = "journalVoucherCreate";
                this.className = 'selectLedgerOnJournal';
                $(`#${this.modalNameToOpen}`).modal('show');
            }
            if(modalName === 'expenses_voucher'){
                this.addShares = false;
                this.voucher_type_to_open = modalName;
                this.modalNameToOpen = "expenseVoucherCreate";
                this.className = 'selectLedgerOnExpenses';
                $(`#${this.modalNameToOpen}`).modal('show');
            }
            if(modalName === 'income_voucher'){
                this.addShares = false;
                this.voucher_type_to_open = modalName;
                this.modalNameToOpen = "incomeVoucherCreate";
                this.className = 'selectLedgerOnIncome';
                $(`#${this.modalNameToOpen}`).modal('show');
            }
            if(modalName === 'payment_voucher'){
                this.addShares = false;
                this.voucher_type_to_open = modalName;
                this.modalNameToOpen = "paymentVoucherCreate";
                this.className = 'selectLedgerOnPurchase';
                $(`#${this.modalNameToOpen}`).modal('show');
            }
            if(modalName === 'receipt_voucher'){
                this.voucher_type_to_open = modalName;
                this.modalNameToOpen = "receiptVoucherCreate";
                this.className = 'selectLedgerOnReceipt';
                $(`#${this.modalNameToOpen}`).modal('show');
            }

            this.$nextTick(() => {
                this.initializeSelect2($(`.${this.className}`), this.modalNameToOpen, this.addShares);
            });

            // Fetch voucher data
            axios.get(`http://127.0.0.1:8000/api/voucher_type/?voucher_type=${modalName}`)
                .then(response => {
                    this.vouchersList = response.data;
                    console.log("voucher is:==>", this.vouchersList)
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        },
        totalBillAmount() {
            return this.items.reduce((sum, item) => sum + parseInt(item.billAmount || 0, 10), 0);
        },
        removeCostCenter(index) {
            this.purchases.splice(index, 1);
            //this.totalAmount();
        },
        //totalAmount() {
        //    this.totalAmountValue = this.purchases.reduce((total, item) => total + (item.amount || 0), 0);
        //    return this.totalAmountValue;
        //},
        calculateAmount(item) {
            if (item.quantity !== undefined && item.rate !== undefined) {
                item.amount = item.quantity * item.rate;
                //this.totalAmount();
            }
        },
        //if (this.totalBillAmount() >= this.purchases.amount) {
        //    this.showSave = true;
        //    return;
        //}
        fetchVoucherNumber2(event) {
            if (!event.target.value) {
                this.formData2.voucher_number = '';
                return;
            }

            axios.get(`http://127.0.0.1:8000/api/get_voucher_number/${event.target.value}`)
                .then(response => {
                    console.log("Response in voucher number===>", response.data);
                    this.formData2.voucher_number = response.data.voucher_number;
                    this.formData2.prefix = response.data.prefix;
                    this.formData2.suffix = response.data.suffix;
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        },
        fetchVoucherNumber(event) {
            if (!event.target.value) {
                this.formData.voucher_number = '';
                return;
            }

            axios.get(`http://127.0.0.1:8000/api/get_voucher_number/${event.target.value}`)
                .then(response => {
                    console.log("Response in voucher number===>", response.data);
                    this.formData.voucher_number = response.data.voucher_number;
                    this.formData.prefix = response.data.prefix;
                    this.formData.suffix = response.data.suffix;
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        },
        createNewLedgerBtn() {
            $('#createNewLedger').modal('hide');
            $(`#${this.modalNameToOpen}`).modal('show');
        },
        getCountries() {
            axios.get('https://api.countrystatecity.in/v1/countries', {
                headers: {
                    'X-CSCAPI-KEY': 'UkJTWGNaT3BVb2I5RnBZSzFzajRubklKSUVWbFVnMjhrMjdrYmZqdA=='
                }
            })
                .then(response => {
                    this.countries = response.data;
                })
                .catch(error => {
                    console.error('Error fetching countries:', error);
                });
        },
        getStates() {
            if (!this.formData.country) return;
            axios.get(`https://api.countrystatecity.in/v1/countries/${this.formData.country}/states`, {
                headers: {
                    'X-CSCAPI-KEY': 'UkJTWGNaT3BVb2I5RnBZSzFzajRubklKSUVWbFVnMjhrMjdrYmZqdA=='
                }
            })
                .then(response => {
                    this.states = response.data;
                    this.cities = [];
                })
                .catch(error => {
                    console.error('Error fetching states:', error);
                });
        },
        getCities() {

            axios.get(`https://api.countrystatecity.in/v1/countries/${this.formData.country}/states/${this.formData.state}/cities`, {
                headers: {
                    'X-CSCAPI-KEY': 'UkJTWGNaT3BVb2I5RnBZSzFzajRubklKSUVWbFVnMjhrMjdrYmZqdA=='
                }
            })
                .then(response => {
                    this.cities = response.data;
                })
                .catch(error => {
                    console.error('Error fetching cities:', error);
                });
        },
        getBranchName() {
            // Make a GET request to the Razorpay IFSC API
            var apiUrl = "https://ifsc.razorpay.com/" + this.formData.ifsc_code;
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch branch name. Please check the IFSC code.');
                    }
                    return response.json();
                })
                .then(data => {
                    this.formData.bank_branch_name = data.BANK;
                    this.formData.branch_name = data.BRANCH;
                })
                .catch(error => {
                    this.formData.bank_branch_name = '';
                    this.formData.branch_name = '';
                });
        },
        submitLedger(id){
            if ($('#ledgerSelection').val() === '') {
                this.groupError = "This field may not be blank."
            }

            let ledgerData = new FormData();
            for (const key in this.formData) {
                if (Object.prototype.hasOwnProperty.call(this.formData, key)) {
                    if (this.formData[key] !== null) {
                        ledgerData.append(key, this.formData[key]);
                    }
                }
            }

            // ADDING GROUP NAME USING JQUERY
            ledgerData.append('group_name', $('#ledgerSelection').val());

            // ADD
            axios.defaults.xsrfCookieName = 'csrftoken';
            axios.defaults.xsrfHeaderName = 'X-CSRFToken';
            axios.post('http://127.0.0.1:8000/api/ledger_creation/', ledgerData)
                .then(response => {
                    toastr.options = {
                        closeButton: true,
                        positionClass: 'toast-top-center',
                        timeOut: 5000
                    };
                    toastr.success(response.message, "Ledger Created Successfully!");
                    $('#createNewLedger').modal('hide');
                    $('#purchaseVoucherCreate').modal('show');
                    this.ledgerList.push(response.data);
                    this.formData = {};
                })
                .catch(error => {
                    this.errors = error.response.data
                    console.log("Error: ->", this.errors);
                });
        },
        viewRequestedData(id, isPurchaseSale){
            console.log("purchase and sale--------->", isPurchaseSale);
            if(Boolean(isPurchaseSale)){
                $('#viewVoucherDataModalPS').modal('show');
            }else{
                $('#viewVoucherDataModal').modal('show');
            }
            axios.get(`http://127.0.0.1:8000/api/voucher_create_ledger/${id}`)
            .then(response => {
                this.showVoucherDetails = response.data;
                console.log("response of view is", response.data);
            })
            .catch(error => {
                console.log("erorr is >", error.response.data);
            })

            // Fetch Related Ledgers
            axios.get(`http://127.0.0.1:8000/api/related-ledgers/${id}`)
            .then(response => {
                this.showRelatedLedgers = response.data;
                console.log("response of view is", response.data);

                let requests = this.showRelatedLedgers.map(item => {
                    return axios.get(`http://127.0.0.1:8000/api/against_refrence_for_self/?against_related_ledger_id__ledger_name=${item.ledger_id}&voucher_type=${item.voucher_type}`)
                        .then(innerResponse => {
                            // Ensure that the 'show_against_refrence' property is set for each item
                            this.$set(item, 'show_against_refrence', innerResponse.data);
                            console.log("showAgainstRefrence =========final=================", innerResponse.data);
                        })
                        .catch(error => {
                            console.log("error is >", error.response.data);
                        });
                });

                // Wait for all inner API calls to complete
                Promise.all(requests).then(() => {
                    console.log("fina final final==============", this.showRelatedLedgers);
                });
            })
            .catch(error => {
                console.log("error is >", error.response.data);
            });

            // Fetch Related Stocks
            axios.get(`http://127.0.0.1:8000/api/stock_vouchers/${id}`)
            .then(response => {
                this.showStocks = response.data;
                console.log("response of view is", response.data);
            })
            .catch(error => {
                console.log("erorr is >", error.response.data);
            })


        },
    },
    mounted() {
        this.getCountries();

        // PUCM DATATABLE
        axios.get('http://127.0.0.1:8000/api/voucher_create_ledger/?voucher_type__voucher_type=purchase_voucher')
            .then(response => {
                this.purchaseVoucherDatatable = response.data;
                console.log("DATA----------------", this.purchaseVoucherDatatable)
                $(document).ready(function () {
                    $('#purchaseVoucherDatatable').DataTable();
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });

        // SVM DATATABLE
        axios.get('http://127.0.0.1:8000/api/voucher_create_ledger/?voucher_type__voucher_type=sale_voucher')
            .then(response => {
                this.salesVoucherDatatable = response.data;
                console.log("DATA----------------", this.salesVoucherDatatable)
                $(document).ready(function () {
                    $('#salesVoucherDatatable').DataTable();
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });

        // JVM DATATABLE
        axios.get('http://127.0.0.1:8000/api/voucher_create_ledger/?voucher_type__voucher_type=general_voucher')
            .then(response => {
                this.generalVoucherDatatable = response.data;
                console.log("DATA----------------", this.generalVoucherDatatable)
                $(document).ready(function () {
                    $('#generalVoucherDatatable').DataTable();
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });

        // EVM DATATABLE
        axios.get('http://127.0.0.1:8000/api/voucher_create_ledger/?voucher_type__voucher_type=expenses_voucher')
            .then(response => {
                this.expenseVoucherDatatable = response.data;
                console.log("DATA----------------", this.expenseVoucherDatatable)
                $(document).ready(function () {
                    $('#expenseVoucherDatatable').DataTable();
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });

        // IVM DATATABLE
        axios.get('http://127.0.0.1:8000/api/voucher_create_ledger/?voucher_type__voucher_type=income_voucher')
            .then(response => {
                this.incomeVoucherDatatable = response.data;
                console.log("DATA----------------", this.incomeVoucherDatatable)
                $(document).ready(function () {
                    $('#incomeVoucherDatatable').DataTable();
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });

        // PVM DATATABLE
        axios.get('http://127.0.0.1:8000/api/voucher_create_ledger/?voucher_type__voucher_type=payment_voucher')
            .then(response => {
                this.paymentVoucherDatatable = response.data;
                console.log("DATA----------------", this.paymentVoucherDatatable)
                $(document).ready(function () {
                    $('#paymentVoucherDatatable').DataTable();
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });

        // RVM DATATABLE
        axios.get('http://127.0.0.1:8000/api/voucher_create_ledger/?voucher_type__voucher_type=receipt_voucher')
            .then(response => {
                this.receiptVoucherDatatable = response.data;
                console.log("DATA----------------", this.receiptVoucherDatatable)
                $(document).ready(function () {
                    $('#receiptVoucherDatatable').DataTable();
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });

        // SHARES DATATABLE DATA
        axios.get('http://127.0.0.1:8000/api/shares_on_ledger_creation/')
            .then(response => {
                this.sharesList = response.data;
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });

        // LEDGER DATATABLE DATA
        axios.get('http://127.0.0.1:8000/api/ledger_creation/')
            .then(response => {
                this.ledgerList = response.data;
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });

        // GROUPS DROPDOWN
        axios.get(`http://127.0.0.1:8000/api/ledger_group/all/`)
            .then(response => {
                this.subGroups = response.data.sub_group;
                $('#ledgerSelection').select2({
                    dropdownParent: $('#ledgerCreation'),
                    width: '100%',
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });


        //$('#receiptVoucherCreate').on('hidden.bs.modal', () => {

        //});
    }
});

</script>
{% endblock body %}